import { cvt_cs_to_os } from "fest/core";
import { borderBoxHeight, borderBoxWidth, contentBoxHeight, contentBoxWidth } from "./Utils";
//
export const getZoom = () => {
    const zoomSupport = "currentCSSZoom" in document.documentElement;
    // @ts-ignore
    if (zoomSupport) {
        return (document.documentElement.currentCSSZoom || 1);
    }
    return parseFloat(document.documentElement.style.getPropertyValue("--scaling") || "1") || 1;
};
//
const zoomValues = new WeakMap();
//
export const zoomOf = (element = document.documentElement) => {
    // @ts-ignore
    return zoomValues.getOrInsertComputed(element, () => {
        // getting zoom performance broken...
        const container = ((element?.matches?.(".ui-orientbox") ? element : null) || element?.closest?.(".ui-orientbox") || document.body);
        // get software zoom value
        if (container?.zoom) {
            return (container?.zoom || 1);
        }
        // get and cache zoom value
        // @ts-ignore
        if (element?.currentCSSZoom) {
            // @ts-ignore
            return element?.currentCSSZoom || 1;
        }
    });
};
//
export const changeZoom = (scale = 1) => {
    document.documentElement.style.setProperty("--scaling", scale);
    document.documentElement.dispatchEvent(new CustomEvent("scaling", {
        detail: { zoom: scale },
        bubbles: true,
        cancelable: true
    }));
    return scale;
};
//
export const fixedClientZoom = (element = document.documentElement) => {
    // @ts-ignore
    return ((element?.currentCSSZoom != null ? 1 : zoomOf(element))) || 1;
};
//
export const unfixedClientZoom = (element = document.documentElement) => {
    // @ts-ignore
    return ((element?.currentCSSZoom == null ? 1 : element?.currentCSSZoom)) || 1;
};
//
export const orientOf = (element = document.documentElement) => {
    // legacy browser
    const container = ((element?.matches?.("[orient], [data-mixin=\"ui-orientbox\"]") ? element : null) || element?.closest?.("[orient], [data-mixin=\"ui-orientbox\"]") || element);
    if (container?.hasAttribute?.("orient")) {
        return parseInt(container?.getAttribute?.("orient") || "0") || 0;
    }
    ;
    return (container?.orient || 0);
};
//
export const getBoundingOrientRect = (element, orient = null) => {
    const zoom = unfixedClientZoom(element) || 1;
    const box = element?.getBoundingClientRect?.();
    const nbx = {
        left: box?.left / zoom,
        right: box?.right / zoom,
        top: box?.top / zoom,
        bottom: box?.bottom / zoom,
        width: box?.width / zoom,
        height: box?.height / zoom,
    };
    //
    const or_i = orient ?? (orientOf(element) || 0);
    const size = [document.body.clientWidth / zoom, document.body.clientHeight / zoom];
    const [left_, top_] = cvt_cs_to_os([nbx.left, nbx.top], size, or_i);
    const [right_, bottom_] = cvt_cs_to_os([nbx.right, nbx.bottom], size, or_i);
    //
    const [left, right] = (or_i == 0 || or_i == 3) ? [left_, right_] : [right_, left_];
    const [top, bottom] = (or_i == 0 || or_i == 1) ? [top_, bottom_] : [bottom_, top_];
    //
    const [width, height] = (or_i % 2) ? [nbx.height, nbx.width] : [nbx.width, nbx.height];
    return { left, top, right, bottom, width, height };
};
//
export const bbw = (el, orient = null) => ((orient ?? orientOf(el)) % 2 ? (el[borderBoxHeight] ?? el?.clientHeight) : (el[borderBoxWidth] ?? el?.clientWidth));
export const bbh = (el, orient = null) => ((orient ?? orientOf(el)) % 2 ? (el[borderBoxWidth] ?? el?.clientWidth) : (el[borderBoxHeight] ?? el?.clientHeight));
export const cbw = (el, orient = null) => ((orient ?? orientOf(el)) % 2 ? (el[contentBoxHeight] ?? el?.clientHeight) : (el[contentBoxWidth] ?? el?.clientWidth));
export const cbh = (el, orient = null) => ((orient ?? orientOf(el)) % 2 ? (el[contentBoxWidth] ?? el?.clientWidth) : (el[contentBoxHeight] ?? el?.clientHeight));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiWm9vbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlpvb20udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUN6QyxPQUFPLEVBQUUsZUFBZSxFQUFFLGNBQWMsRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFFN0YsRUFBRTtBQUNGLE1BQU0sQ0FBQyxNQUFNLE9BQU8sR0FBRyxHQUFFLEVBQUU7SUFDdkIsTUFBTSxXQUFXLEdBQUcsZ0JBQWdCLElBQUksUUFBUSxDQUFDLGVBQWUsQ0FBQztJQUNqRSxhQUFhO0lBQ2IsSUFBSSxXQUFXLEVBQUUsQ0FBQztRQUFDLE9BQU8sQ0FBRSxRQUFRLENBQUMsZUFBZSxDQUFDLGNBQXlCLElBQUksQ0FBQyxDQUFDLENBQUM7SUFBQyxDQUFDO0lBQ3ZGLE9BQU8sVUFBVSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNoRyxDQUFDLENBQUE7QUFFRCxFQUFFO0FBQ0YsTUFBTSxVQUFVLEdBQUcsSUFBSSxPQUFPLEVBQXVCLENBQUM7QUFFdEQsRUFBRTtBQUNGLE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxDQUFDLE9BQU8sR0FBRyxRQUFRLENBQUMsZUFBZSxFQUFFLEVBQUU7SUFDekQsYUFBYTtJQUNiLE9BQU8sVUFBVSxDQUFDLG1CQUFtQixDQUFDLE9BQU8sRUFBRSxHQUFFLEVBQUU7UUFDL0MscUNBQXFDO1FBQ3JDLE1BQU0sU0FBUyxHQUFRLENBQUMsQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDLGVBQWUsQ0FBQyxJQUFJLFFB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QUNSLElBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxHQUFHLElBQUk7UUFDdEIsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEdBQUcsSUFBSTtRQUN4QixHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsR0FBRyxJQUFJO1FBQ3BCLE1BQU0sRUFBRSxHQUFHLEVBQUUsTUFBTSxHQUFHLElBQUk7UUFDMUIsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEdBQUcsSUFBSTtRQUN4QixNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sR0FBRyxJQUFJO0tBQzdCLENBQUM7SUFFRixFQUFFO0lBQ0YsTUFBTSxJQUFJLEdBQVcsTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ3hELE1BQU0sSUFBSSxHQUFxQixDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsQ0FBQztJQUNyRyxNQUFNLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxHQUFHLFlBQVksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNwRSxNQUFNLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxHQUFHLFlBQVksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUU1RSxFQUFFO0lBQ0YsTUFBTSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksSUFBRSxDQUFDLElBQUksSUFBSSxJQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDL0UsTUFBTSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksSUFBRSxDQUFDLElBQUksSUFBSSxJQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFFL0UsRUFBRTtJQUNGLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDckYsT0FBTyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUM7QUFDdkQsQ0FBQyxDQUFBO0FBRUQsRUFBRTtBQUNGLE1BQU0sQ0FBQyxNQUFNLEdBQUcsR0FBTSxDQUFDLEVBQUUsRUFBRSxNQUFNLEdBQUcsSUFBSSxFQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxJQUFFLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQztBQUM3SixNQUFNLENBQUMsTUFBTSxHQUFHLEdBQU0sQ0FBQyxFQUFFLEVBQUUsTUFBTSxHQUFHLElBQUksRUFBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sSUFBRSxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUM7QUFDN0osTUFBTSxDQUFDLE1BQU0sR0FBRyxHQUFNLENBQUMsRUFBRSxFQUFFLE1BQU0sR0FBRyxJQUFJLEVBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLElBQUUsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsRUFBRSxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7QUFDL0osTUFBTSxDQUFDLE1BQU0sR0FBRyxHQUFNLENBQUMsRUFBRSxFQUFFLE1BQU0sR0FBRyxJQUFJLEVBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLElBQUUsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjdnRfY3NfdG9fb3MgfSBmcm9tIFwiZmVzdC9jb3JlXCI7XG5pbXBvcnQgeyBib3JkZXJCb3hIZWlnaHQsIGJvcmRlckJveFdpZHRoLCBjb250ZW50Qm94SGVpZ2h0LCBjb250ZW50Qm94V2lkdGggfSBmcm9tIFwiLi9VdGlsc1wiO1xuXG4vL1xuZXhwb3J0IGNvbnN0IGdldFpvb20gPSAoKT0+e1xuICAgIGNvbnN0IHpvb21TdXBwb3J0ID0gXCJjdXJyZW50Q1NTWm9vbVwiIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgaWYgKHpvb21TdXBwb3J0KSB7IHJldHVybiAoKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jdXJyZW50Q1NTWm9vbSBhcyBudW1iZXIpIHx8IDEpOyB9XG4gICAgcmV0dXJuIHBhcnNlRmxvYXQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLmdldFByb3BlcnR5VmFsdWUoXCItLXNjYWxpbmdcIikgfHwgXCIxXCIpIHx8IDE7XG59XG5cbi8vXG5jb25zdCB6b29tVmFsdWVzID0gbmV3IFdlYWtNYXA8SFRNTEVsZW1lbnQsIG51bWJlcj4oKTtcblxuLy9cbmV4cG9ydCBjb25zdCB6b29tT2YgPSAoZWxlbWVudCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkgPT4ge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICByZXR1cm4gem9vbVZhbHVlcy5nZXRPckluc2VydENvbXB1dGVkKGVsZW1lbnQsICgpPT57XG4gICAgICAgIC8vIGdldHRpbmcgem9vbSBwZXJmb3JtYW5jZSBicm9rZW4uLi5cbiAgICAgICAgY29uc3QgY29udGFpbmVyOiBhbnkgPSAoKGVsZW1lbnQ/Lm1hdGNoZXM/LihcIi51aS1vcmllbnRib3hcIikgPyBlbGVtZW50IDogbnVsbCkgfHwgZWxlbWVudD8uY2xvc2VzdD8uKFwiLnVpLW9yaWVudGJveFwiKSB8fCBkb2N1bWVudC5ib2R5KSBhcyBIVE1MRWxlbWVudDtcblxuICAgICAgICAvLyBnZXQgc29mdHdhcmUgem9vbSB2YWx1ZVxuICAgICAgICBpZiAoY29udGFpbmVyPy56b29tKSB7XG4gICAgICAgICAgICByZXR1cm4gKGNvbnRhaW5lcj8uem9vbSB8fCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGdldCBhbmQgY2FjaGUgem9vbSB2YWx1ZVxuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGlmIChlbGVtZW50Py5jdXJyZW50Q1NTWm9vbSkge1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ/LmN1cnJlbnRDU1Nab29tIHx8IDE7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuLy9cbmV4cG9ydCBjb25zdCBjaGFuZ2Vab29tID0gKHNjYWxlID0gMSkgPT4ge1xuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eShcIi0tc2NhbGluZ1wiLCBzY2FsZSBhcyB1bmtub3duIGFzIHN0cmluZyk7XG4gICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwic2NhbGluZ1wiLCB7XG4gICAgICAgIGRldGFpbDoge3pvb206IHNjYWxlfSxcbiAgICAgICAgYnViYmxlczogdHJ1ZSxcbiAgICAgICAgY2FuY2VsYWJsZTogdHJ1ZVxuICAgIH0pKTtcbiAgICByZXR1cm4gc2NhbGU7XG59XG5cbi8vXG5leHBvcnQgY29uc3QgZml4ZWRDbGllbnRab29tID0gKGVsZW1lbnQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpPT57XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHJldHVybiAoKGVsZW1lbnQ/LmN1cnJlbnRDU1Nab29tICE9IG51bGwgPyAxIDogem9vbU9mKGVsZW1lbnQpKSkgfHwgMTtcbn1cblxuLy9cbmV4cG9ydCBjb25zdCB1bmZpeGVkQ2xpZW50Wm9vbSA9IChlbGVtZW50ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KT0+e1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICByZXR1cm4gKChlbGVtZW50Py5jdXJyZW50Q1NTWm9vbSA9PSBudWxsID8gMSA6IGVsZW1lbnQ/LmN1cnJlbnRDU1Nab29tKSkgfHwgMTtcbn1cblxuLy9cbmV4cG9ydCBjb25zdCBvcmllbnRPZiA9IChlbGVtZW50ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSA9PiB7XG4gICAgLy8gbGVnYWN5IGJyb3dzZXJcbiAgICBjb25zdCBjb250YWluZXI6IGFueSA9ICgoZWxlbWVudD8ubWF0Y2hlcz8uKFwiW29yaWVudF0sIFtkYXRhLW1peGluPVxcXCJ1aS1vcmllbnRib3hcXFwiXVwiKSA/IGVsZW1lbnQgOiBudWxsKSB8fCBlbGVtZW50Py5jbG9zZXN0Py4oXCJbb3JpZW50XSwgW2RhdGEtbWl4aW49XFxcInVpLW9yaWVudGJveFxcXCJdXCIpIHx8IGVsZW1lbnQpO1xuICAgIGlmIChjb250YWluZXI/Lmhhc0F0dHJpYnV0ZT8uKFwib3JpZW50XCIpKSB7IHJldHVybiBwYXJzZUludChjb250YWluZXI/LmdldEF0dHJpYnV0ZT8uKFwib3JpZW50XCIpIHx8IFwiMFwiKSB8fCAwOyB9O1xuICAgIHJldHVybiAoY29udGFpbmVyPy5vcmllbnQgfHwgMCk7XG59XG5cbi8vXG5leHBvcnQgY29uc3QgZ2V0Qm91bmRpbmdPcmllbnRSZWN0ID0gKGVsZW1lbnQsIG9yaWVudDogbnVtYmVyfG51bGx8dW5kZWZpbmVkID0gbnVsbCk9PntcbiAgICBjb25zdCB6b29tID0gdW5maXhlZENsaWVudFpvb20oZWxlbWVudCkgfHwgMTtcbiAgICBjb25zdCBib3ggPSBlbGVtZW50Py5nZXRCb3VuZGluZ0NsaWVudFJlY3Q/LigpO1xuICAgIGNvbnN0IG5ieCA9IHtcbiAgICAgICAgbGVmdDogYm94Py5sZWZ0IC8gem9vbSxcbiAgICAgICAgcmlnaHQ6IGJveD8ucmlnaHQgLyB6b29tLFxuICAgICAgICB0b3A6IGJveD8udG9wIC8gem9vbSxcbiAgICAgICAgYm90dG9tOiBib3g/LmJvdHRvbSAvIHpvb20sXG4gICAgICAgIHdpZHRoOiBib3g/LndpZHRoIC8gem9vbSxcbiAgICAgICAgaGVpZ2h0OiBib3g/LmhlaWdodCAvIHpvb20sXG4gICAgfTtcblxuICAgIC8vXG4gICAgY29uc3Qgb3JfaTogbnVtYmVyID0gb3JpZW50ID8/IChvcmllbnRPZihlbGVtZW50KSB8fCAwKTtcbiAgICBjb25zdCBzaXplOiBbbnVtYmVyLCBudW1iZXJdID0gW2RvY3VtZW50LmJvZHkuY2xpZW50V2lkdGggLyB6b29tLCBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCAvIHpvb21dO1xuICAgIGNvbnN0IFtsZWZ0XywgdG9wX10gPSBjdnRfY3NfdG9fb3MoW25ieC5sZWZ0LCBuYngudG9wXSwgc2l6ZSwgb3JfaSk7XG4gICAgY29uc3QgW3JpZ2h0XywgYm90dG9tX10gPSBjdnRfY3NfdG9fb3MoW25ieC5yaWdodCwgbmJ4LmJvdHRvbV0sIHNpemUsIG9yX2kpO1xuXG4gICAgLy9cbiAgICBjb25zdCBbbGVmdCwgcmlnaHRdID0gKG9yX2k9PTAgfHwgb3JfaT09MykgPyBbbGVmdF8sIHJpZ2h0X10gOiBbcmlnaHRfLCBsZWZ0X107XG4gICAgY29uc3QgW3RvcCwgYm90dG9tXSA9IChvcl9pPT0wIHx8IG9yX2k9PTEpID8gW3RvcF8sIGJvdHRvbV9dIDogW2JvdHRvbV8sIHRvcF9dO1xuXG4gICAgLy9cbiAgICBjb25zdCBbd2lkdGgsIGhlaWdodF0gPSAob3JfaSUyKSA/IFtuYnguaGVpZ2h0LCBuYngud2lkdGhdIDogW25ieC53aWR0aCwgbmJ4LmhlaWdodF07XG4gICAgcmV0dXJuIHsgbGVmdCwgdG9wLCByaWdodCwgYm90dG9tLCB3aWR0aCwgaGVpZ2h0IH07XG59XG5cbi8vXG5leHBvcnQgY29uc3QgYmJ3ICAgID0gKGVsLCBvcmllbnQgPSBudWxsKT0+ICgob3JpZW50Pz9vcmllbnRPZihlbCkpJTIgPyAoZWxbYm9yZGVyQm94SGVpZ2h0XSA/PyBlbD8uY2xpZW50SGVpZ2h0KSA6IChlbFtib3JkZXJCb3hXaWR0aF0gPz8gZWw/LmNsaWVudFdpZHRoKSk7XG5leHBvcnQgY29uc3QgYmJoICAgID0gKGVsLCBvcmllbnQgPSBudWxsKT0+ICgob3JpZW50Pz9vcmllbnRPZihlbCkpJTIgPyAoZWxbYm9yZGVyQm94V2lkdGhdID8/IGVsPy5jbGllbnRXaWR0aCkgOiAoZWxbYm9yZGVyQm94SGVpZ2h0XSA/PyBlbD8uY2xpZW50SGVpZ2h0KSk7XG5leHBvcnQgY29uc3QgY2J3ICAgID0gKGVsLCBvcmllbnQgPSBudWxsKT0+ICgob3JpZW50Pz9vcmllbnRPZihlbCkpJTIgPyAoZWxbY29udGVudEJveEhlaWdodF0gPz8gZWw/LmNsaWVudEhlaWdodCkgOiAoZWxbY29udGVudEJveFdpZHRoXSA/PyBlbD8uY2xpZW50V2lkdGgpKTtcbmV4cG9ydCBjb25zdCBjYmggICAgPSAoZWwsIG9yaWVudCA9IG51bGwpPT4gKChvcmllbnQ/P29yaWVudE9mKGVsKSklMiA/IChlbFtjb250ZW50Qm94V2lkdGhdID8/IGVsPy5jbGllbnRXaWR0aCkgOiAoZWxbY29udGVudEJveEhlaWdodF0gPz8gZWw/LmNsaWVudEhlaWdodCkpO1xuIl19