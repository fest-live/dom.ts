import { isArrayOrIterable } from "fest/core";
//
export const getOffsetParent = (element) => { return element?.offsetParent ?? element?.host; };
export const getOffsetParentChain = (element) => {
    const parents = [];
    let current = element;
    while (current) {
        const parent = getOffsetParent(current);
        if (parent && (parent instanceof HTMLHtmlElement)) {
            break;
        }
        if (current = parent) {
            parents.push(current);
        }
    }
    return parents;
};
//
export const isNearlyIdentity = (matrix, epsilon = 1e-6) => {
    return (Math.abs(matrix.a - 1) < epsilon &&
        Math.abs(matrix.b) < epsilon &&
        Math.abs(matrix.c) < epsilon &&
        Math.abs(matrix.d - 1) < epsilon &&
        Math.abs(matrix.e) < epsilon &&
        Math.abs(matrix.f) < epsilon);
};
//
export const makeRAFCycle = () => {
    const control = {
        canceled: false,
        rAFs: new Set(),
        last: null,
        cancel() { this.canceled = true; cancelAnimationFrame(this.last); return this; },
        shedule(cb) { this.rAFs.add(cb); return this; }
    };
    (async () => {
        while (!control?.canceled) { // @ts-ignore
            await Promise.all((control?.rAFs?.values?.() ?? [])?.map?.((rAF) => Promise.try(rAF)?.catch?.(console.warn.bind(console))));
            control.rAFs?.clear?.();
            if (typeof requestAnimationFrame != "undefined") {
                await new Promise((res) => { control.last = requestAnimationFrame(res); });
            }
            else {
                await new Promise((res) => { setTimeout(res, 16); });
            }
        }
    })();
    return control;
};
//
export const RAFBehavior = (shed = makeRAFCycle()) => {
    return (cb) => shed.shedule(cb);
};
;
export const ROOT = typeof document != "undefined" ? document?.documentElement : null;
export const setAttributesIfNull = (element, attrs = {}) => {
    if (!attrs || (typeof attrs != "object") || !element)
        return;
    return Array.from(Object.entries(attrs)).map(([name, value]) => {
        const old = element.getAttribute(name);
        if (value == null) {
            element.removeAttribute(name);
        }
        else if (value != old) {
            element.setAttribute(name, old == "" ? (value ?? old) : (old ?? value));
        }
    });
};
//
export const setAttributes = (element, attrs = {}) => {
    return Array.from(Object.entries(attrs)).map(([name, value]) => {
        if (value == null) {
            element.removeAttribute(name);
        }
        else {
            element.setAttribute(name, value ?? element.getAttribute(name));
        }
    });
};
//
export const throttleMap = new Map();
export const setIdleInterval = (cb, timeout = 1000, ...args) => {
    const status = { running: true, cancel: () => { status.running = false; } };
    requestIdleCallback(async () => {
        if (!cb || (typeof cb != "function"))
            return;
        while (status.running) {
            await Promise.all([
                Promise.try(cb, ...args),
                new Promise((r) => setTimeout(r, timeout))
            ]).catch?.(console.warn.bind(console));
            //
            await Promise.any([
                new Promise((r) => requestIdleCallback(r, { timeout })),
                new Promise((r) => setTimeout(r, timeout))
                //new Promise((r)=>requestAnimationFrame(r))
            ]);
        }
        status.cancel = () => { };
    }, { timeout });
    return status?.cancel;
};
//
if (typeof requestAnimationFrame != "undefined") {
    requestAnimationFrame(async () => {
        while (true) {
            throttleMap.forEach((cb) => cb?.());
            await new Promise((r) => requestAnimationFrame(r));
        }
    });
}
//
export const borderBoxWidth = Symbol("@border-box-width"), borderBoxHeight = Symbol("@border-box-height");
export const contentBoxWidth = Symbol("@content-box-width"), contentBoxHeight = Symbol("@content-box-height");
export const onBorderObserve = new WeakMap();
export const onContentObserve = new WeakMap();
export const doContentObserve = (element, cb = () => { }) => {
    if (!(element instanceof HTMLElement))
        return;
    if (!onContentObserve.has(element)) {
        element[contentBoxWidth] = (element.clientWidth);
        element[contentBoxHeight] = (element.clientHeight);
        //
        const observer = new ResizeObserver((entries) => {
            for (const entry of entries) {
                if (entry.contentBoxSize) {
                    const contentBoxSize = entry.contentBoxSize[0];
                    if (contentBoxSize) {
                        element[contentBoxWidth] = Math.min(contentBoxSize.inlineSize, element.clientWidth);
                        element[contentBoxHeight] = Math.min(contentBoxSize.blockSize, element.clientHeight);
                        cb?.(element);
                    }
                }
            }
        });
        //
        onContentObserve.set(element, observer);
        observer.observe(element?.element ?? element, { box: "content-box" });
    }
};
//
export const doBorderObserve = (element, cb = () => { }) => {
    if (!(element instanceof HTMLElement))
        return;
    if (!onBorderObserve.has(element)) {
        element[borderBoxWidth] = element.offsetWidth;
        element[borderBoxHeight] = element.offsetHeight;
        const observer = new ResizeObserver((entries) => {
            for (const entry of entries) {
                if (entry.borderBoxSize) {
                    const borderBoxSize = entry.borderBoxSize[0];
                    if (borderBoxSize) {
                        element[borderBoxWidth] = Math.min(borderBoxSize.inlineSize, element.offsetWidth);
                        element[borderBoxHeight] = Math.min(borderBoxSize.blockSize, element.offsetHeight);
                        cb?.(element);
                    }
                }
            }
        });
        //
        onBorderObserve.set(element, observer);
        observer.observe(element?.element ?? element, { box: "border-box" });
    }
};
//
export const url = (type, ...source) => { return URL.createObjectURL(new Blob(source, { type })); };
export const html = (source, type = 'text/html') => {
    const parsed = (new DOMParser()).parseFromString(source, type);
    return parsed.querySelector('template') ?? parsed.querySelector("*");
};
//
export const setChecked = (input, value, ev) => {
    if (value != null && input.checked != value) {
        if ((input?.['type'] == "checkbox") ||
            (input?.['type'] == "radio" && !input?.checked)) {
            input?.click?.();
            ev?.preventDefault?.();
        }
        else {
            input.checked = !!value;
            input?.dispatchEvent?.(new Event("change", { bubbles: true, cancelable: true, }));
        }
    }
};
//
export const isValidParent = (parent) => {
    return (parent != null && parent instanceof HTMLElement && !(parent instanceof DocumentFragment || parent instanceof HTMLBodyElement)) ? parent : null;
};
//
export const indexOf = (element, node) => {
    if (element == null || node == null)
        return -1;
    return Array.from(element?.childNodes ?? [])?.indexOf?.(node) ?? -1;
};
//
export const MATCH = '(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)', REGEX = '^(?:' + MATCH + ')|^#' + MATCH + '|^\\.' + MATCH + '|^\\[' + MATCH + '(?:([*$|~^]?=)(["\'])((?:(?=(\\\\?))\\8.)*?)\\6)?\\]';
//
export const createElementVanilla = (selector) => {
    if (selector == ":fragment:")
        return document.createDocumentFragment();
    const create = document.createElement.bind(document);
    for (var node = create('div'), match, className = ''; selector && (match = selector.match(REGEX));) {
        if (match[1])
            node = create(match[1]);
        if (match[2])
            node.id = match[2];
        if (match[3])
            className += ' ' + match[3];
        if (match[4])
            node.setAttribute(match[4], match[7] || '');
        selector = selector.slice(match[0].length);
    }
    if (className)
        node.className = className.slice(1);
    return node;
};
//
export const isElement = (el) => { return el != null && (el instanceof Node || el instanceof Text || el instanceof Element || el instanceof Comment || el instanceof HTMLElement || el instanceof DocumentFragment) ? el : null; };
export const includeSelf = (target, selector) => { return (target.querySelector(selector) ?? (target.matches(selector) ? target : null)); };
export const hasParent = (current, parent) => { while (current) {
    if (!(current?.element ?? current)) {
        return false;
    }
    ;
    if ((current?.element ?? current) === (parent?.element ?? parent))
        return true;
    current = current.parentElement ?? (current.parentNode == current?.getRootNode?.({ composed: true }) ? current?.getRootNode?.({ composed: true })?.host : current?.parentNode);
} };
export const passiveOpts = {};
//
export function addEvent(target, type, cb, opts = passiveOpts) {
    target?.addEventListener?.(type, cb, opts);
    const wr = (typeof target == "object" || typeof target == "function" && !target?.deref) ? new WeakRef(target) : target;
    return () => wr?.deref?.()?.removeEventListener?.(type, cb, opts);
    //return () => target?.removeEventListener?.(type, cb, opts);
}
//
export function removeEvent(target, type, cb, opts = passiveOpts) {
    target?.removeEventListener?.(type, cb, opts);
}
// add events by map of [name, cb] in 'handlers'
// where cb is Function or [Function, options]
export const addEvents = (root, handlers) => {
    root = (root instanceof WeakRef ? root.deref() : root); // @ts-ignore
    return [...Object.entries(handlers)]?.map?.(([name, cb]) => (Array.isArray(cb) ? addEvent(root, name, ...cb) : addEvent(root, name, cb)));
};
// add events by map of [name, cbs[]] in 'events'
// where cb of cbs[] is Function or [Function, options]
// however, [Function, options] not implemented yet
export const addEventsList = (el, events) => {
    if (events) {
        let entries = events;
        if (events instanceof Map) {
            entries = [...events.entries()];
        }
        else {
            entries = [...Object.entries(events)];
        }
        return entries.map(([name, list]) => ((isArrayOrIterable(list) ? [...list] : list) ?? [])?.map?.((cbs) => {
            return addEvent(el, name, cbs);
        }));
    }
};
//
export const removeEvents = (root, handlers) => {
    root = (root instanceof WeakRef ? root.deref() : root); // @ts-ignore
    return [...Object.entries(handlers)]?.map?.(([name, cb]) => (Array.isArray(cb) ? removeEvent(root, name, ...cb) : removeEvent(root, name, cb)));
};
//
// Get the actual target element from an event, considering shadow DOM boundaries
export const getEventTarget = (ev) => {
    if (!ev)
        return null;
    // Use composedPath() for shadow DOM compatibility
    if (ev?.composedPath && typeof ev.composedPath === 'function') {
        const path = ev.composedPath();
        // Return the first element in the path (the actual target)
        for (const node of path) {
            if (node instanceof HTMLElement || node instanceof Element) {
                return node;
            }
        }
    }
    // Fallback to target property
    const target = ev?.target;
    if (target instanceof HTMLElement || target instanceof Element) {
        return target;
    }
    return null;
};
//
export const containsOrSelf = (a, b, ev) => {
    if (b == null || !(b instanceof Node) && b?.element == null)
        return false; // if isn't node with element or just null
    if ((a == b) || (a?.element ?? a) == (b?.element ?? b))
        return true; // wrapper or element is same
    // Use composedPath() for shadow DOM compatibility if event is provided
    if (ev?.composedPath && typeof ev.composedPath === 'function') {
        const path = ev.composedPath();
        const aEl = a?.element ?? a;
        const bEl = b?.element ?? b;
        if (path.includes(aEl) && path.includes(bEl)) {
            // Check if b appears before a in the path (b is deeper/child of a)
            const aIndex = path.indexOf(aEl);
            const bIndex = path.indexOf(bEl);
            if (bIndex >= 0 && aIndex >= 0 && bIndex < aIndex)
                return true;
        }
    }
    if (a?.contains?.(b?.element ?? b) || a?.getRootNode({ composed: true })?.host == (b?.element ?? b))
        return true; // a contains b element
    return false;
};
// get by selector self or parent, matches by selector, include shadow DOM host
export const MOCElement = (element, selector, ev) => {
    // Use composedPath() for shadow DOM compatibility if event is provided
    if (ev?.composedPath && typeof ev.composedPath === 'function') {
        const path = ev.composedPath();
        // Search through the composed path for matching elements
        for (const node of path) {
            if (node instanceof HTMLElement || node instanceof Element) {
                if (node.matches?.(selector)) {
                    return node;
                }
            }
        }
    }
    const self = (element?.matches?.(selector) ? element : null);
    const host = (element?.getRootNode({ composed: true }) ?? element?.parentElement?.getRootNode({ composed: true }))?.host;
    const hostMatched = host?.matches?.(selector) ? host : null;
    const closest = element?.closest?.(selector) ?? self?.closest?.(selector) ?? hostMatched?.closest?.(selector) ?? null;
    return (self ?? closest ?? hostMatched);
};
//
export const MOC = (element, selector) => { return !!MOCElement(element, selector); };
//
export const isInFocus = (element, selectorOrElement, dir = "parent") => {
    if (!element)
        return false;
    // Visibility Check (if supported, otherwise basic offsetParent)
    // @ts-ignore
    if (element.checkVisibility && !element.checkVisibility({ checkOpacity: true, checkVisibilityCSS: true }))
        return false;
    // @ts-ignore
    if (!element.checkVisibility && element.offsetParent === null && element.style.position !== 'fixed')
        return false;
    // Deep Active Element Resolution
    let active = document.activeElement;
    while (active && active.shadowRoot && active.shadowRoot.activeElement) {
        active = active.shadowRoot.activeElement;
    }
    // Interaction Status
    const isFocused = (active === element) || hasParent(active, element);
    const isHovered = element.matches(":hover");
    // Top-most check for hover (optional, but requested "elementFromPoint")
    // Only worth checking if hovered but not focused, to see if it's occluded?
    // Skipping expensive rect calc for now unless strictly needed, :hover is usually reliable for CSS pointer-events.
    if (!isFocused && !isHovered && !selectorOrElement)
        return false;
    // Constraints
    if (selectorOrElement) {
        if (typeof selectorOrElement === "string") {
            if (dir === "parent") {
                // Does the element (or its context) match the selector?
                return !!MOCElement(element, selectorOrElement);
            }
            else {
                // Does the interaction target inside match the selector?
                const target = isFocused ? active : (element.querySelector(":hover") || element);
                const altCnd = !!MOCElement(target, selectorOrElement);
                return (element?.querySelector?.(selectorOrElement) != null || element?.matches?.(selectorOrElement) || altCnd);
            }
        }
        else if (selectorOrElement instanceof HTMLElement) {
            if (dir === "parent") {
                return hasParent(element, selectorOrElement) || false;
            }
            else {
                return hasParent(selectorOrElement, element) || false;
            }
        }
    }
    return true;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJVdGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFOUMsRUFBRTtBQUNGLE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBRyxDQUFDLE9BQWdCLEVBQWtCLEVBQUUsR0FBRyxPQUFRLE9BQXVCLEVBQUUsWUFBWSxJQUFLLE9BQWUsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDakosTUFBTSxDQUFDLE1BQU0sb0JBQW9CLEdBQUcsQ0FBQyxPQUFnQixFQUFhLEVBQUU7SUFDaEUsTUFBTSxPQUFPLEdBQWMsRUFBRSxDQUFDO0lBQUMsSUFBSSxPQUFPLEdBQW1CLE9BQU8sQ0FBQztJQUNyRSxPQUFPLE9BQU8sRUFBRSxDQUFDO1FBQ2IsTUFBTSxNQUFNLEdBQUcsZUFBZSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3hDLElBQUksTUFBTSxJQUFJLENBQUMsTUFBTSxZQUFZLGVBQWUsQ0FBQyxFQUFFLENBQUM7WUFBQyxNQUFNO1FBQUMsQ0FBQztRQUM3RCxJQUFJLE9BQU8sR0FBRyxNQUFNLEVBQUUsQ0FBQztZQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFBQyxDQUFDO0lBQ3BELENBQUM7SUFDRCxPQUFPLE9BQU8sQ0FBQztBQUNuQixDQUFDLENBQUE7QUFFRCxFQUFFO0FBQ0YsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxNQUFpQixFQUFFLFVBQWtCLElBQUksRUFBVyxFQUFFO0lBQ25GLE9BQU8sQ0FDSCxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsT0FBTztRQUNoQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxPQUFPO1FBQzVCLElBQUksQ0FBQyxHQUFHLENBQUMsTUFB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QUMsQ0FBQztZQUNwRCxDQUFDO2lCQUFNLENBQUM7Z0JBQ0oseURBQXlEO2dCQUN6RCxNQUFNLE1BQU0sR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxDQUFDO2dCQUNqRixNQUFNLE1BQU0sR0FBRyxDQUFDLENBQUMsVUFBVSxDQUFDLE1BQXFCLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztnQkFDdEUsT0FBTyxDQUFDLE9BQU8sRUFBRSxhQUFhLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLElBQUksSUFBSSxPQUFPLEVBQUUsT0FBTyxFQUFFLENBQUMsaUJBQWlCLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQztZQUNwSCxDQUFDO1FBQ0wsQ0FBQzthQUFNLElBQUksaUJBQWlCLFlBQVksV0FBVyxFQUFFLENBQUM7WUFDakQsSUFBSSxHQUFHLEtBQUssUUFBUSxFQUFFLENBQUM7Z0JBQ25CLE9BQU8sU0FBUyxDQUFDLE9BQU8sRUFBRSxpQkFBaUIsQ0FBQyxJQUFJLEtBQUssQ0FBQztZQUMxRCxDQUFDO2lCQUFNLENBQUM7Z0JBQ0osT0FBTyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsT0FBTyxDQUFDLElBQUksS0FBSyxDQUFDO1lBQzFELENBQUM7UUFDTixDQUFDO0lBQ0wsQ0FBQztJQUVELE9BQU8sSUFBSSxDQUFDO0FBQ2hCLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGlzQXJyYXlPckl0ZXJhYmxlIH0gZnJvbSBcImZlc3QvY29yZVwiO1xuXG4vL1xuZXhwb3J0IGNvbnN0IGdldE9mZnNldFBhcmVudCA9IChlbGVtZW50OiBFbGVtZW50KTogRWxlbWVudCB8IG51bGwgPT4geyByZXR1cm4gKGVsZW1lbnQgYXMgSFRNTEVsZW1lbnQpPy5vZmZzZXRQYXJlbnQgPz8gKGVsZW1lbnQgYXMgYW55KT8uaG9zdDsgfVxuZXhwb3J0IGNvbnN0IGdldE9mZnNldFBhcmVudENoYWluID0gKGVsZW1lbnQ6IEVsZW1lbnQpOiBFbGVtZW50W10gPT4ge1xuICAgIGNvbnN0IHBhcmVudHM6IEVsZW1lbnRbXSA9IFtdOyBsZXQgY3VycmVudDogRWxlbWVudCB8IG51bGwgPSBlbGVtZW50O1xuICAgIHdoaWxlIChjdXJyZW50KSB7XG4gICAgICAgIGNvbnN0IHBhcmVudCA9IGdldE9mZnNldFBhcmVudChjdXJyZW50KTtcbiAgICAgICAgaWYgKHBhcmVudCAmJiAocGFyZW50IGluc3RhbmNlb2YgSFRNTEh0bWxFbGVtZW50KSkgeyBicmVhazsgfVxuICAgICAgICBpZiAoY3VycmVudCA9IHBhcmVudCkgeyBwYXJlbnRzLnB1c2goY3VycmVudCk7IH1cbiAgICB9XG4gICAgcmV0dXJuIHBhcmVudHM7XG59XG5cbi8vXG5leHBvcnQgY29uc3QgaXNOZWFybHlJZGVudGl0eSA9IChtYXRyaXg6IERPTU1hdHJpeCwgZXBzaWxvbjogbnVtYmVyID0gMWUtNik6IGJvb2xlYW4gPT4ge1xuICAgIHJldHVybiAoXG4gICAgICAgIE1hdGguYWJzKG1hdHJpeC5hIC0gMSkgPCBlcHNpbG9uICYmXG4gICAgICAgIE1hdGguYWJzKG1hdHJpeC5iKSA8IGVwc2lsb24gJiZcbiAgICAgICAgTWF0aC5hYnMobWF0cml4LmMpIDwgZXBzaWxvbiAmJlxuICAgICAgICBNYXRoLmFicyhtYXRyaXguZCAtIDEpIDwgZXBzaWxvbiAmJlxuICAgICAgICBNYXRoLmFicyhtYXRyaXguZSkgPCBlcHNpbG9uICYmXG4gICAgICAgIE1hdGguYWJzKG1hdHJpeC5mKSA8IGVwc2lsb25cbiAgICApO1xufVxuXG4vL1xuZXhwb3J0IGNvbnN0IG1ha2VSQUZDeWNsZSA9ICgpID0+IHtcbiAgICBjb25zdCBjb250cm9sOiBhbnkgPSB7XG4gICAgICAgIGNhbmNlbGVkOiBmYWxzZSxcbiAgICAgICAgckFGczogbmV3IFNldDxhbnk+KCksXG4gICAgICAgIGxhc3Q6IG51bGwsXG4gICAgICAgIGNhbmNlbCgpIHsgdGhpcy5jYW5jZWxlZCA9IHRydWU7IGNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMubGFzdCk7IHJldHVybiB0aGlzOyB9LFxuICAgICAgICBzaGVkdWxlKGNiOiBhbnkpIHsgdGhpcy5yQUZzLmFkZChjYik7IHJldHVybiB0aGlzOyB9XG4gICAgfTtcbiAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgICB3aGlsZSAoIWNvbnRyb2w/LmNhbmNlbGVkKSB7IC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKChjb250cm9sPy5yQUZzPy52YWx1ZXM/LigpID8/IFtdKT8ubWFwPy4oKHJBRikgPT4gUHJvbWlzZS50cnkockFGKT8uY2F0Y2g/Lihjb25zb2xlLndhcm4uYmluZChjb25zb2xlKSkpKTsgY29udHJvbC5yQUZzPy5jbGVhcj8uKCk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHJlcXVlc3RBbmltYXRpb25GcmFtZSAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlcykgPT4geyBjb250cm9sLmxhc3QgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVzKTsgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXMpID0+IHsgc2V0VGltZW91dChyZXMsIDE2KTsgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KSgpO1xuICAgIHJldHVybiBjb250cm9sO1xufTtcblxuLy9cbmV4cG9ydCBjb25zdCBSQUZCZWhhdmlvciA9IChzaGVkID0gbWFrZVJBRkN5Y2xlKCkpID0+IHtcbiAgICByZXR1cm4gKGNiKT0+c2hlZC5zaGVkdWxlKGNiKTtcbn1cblxuLy9cbmV4cG9ydCBpbnRlcmZhY2UgSW50ZXJhY3RTdGF0dXMgeyBwb2ludGVySWQ/OiBudW1iZXI7IH07XG5leHBvcnQgY29uc3QgUk9PVCA9IHR5cGVvZiBkb2N1bWVudCAhPSBcInVuZGVmaW5lZFwiID8gZG9jdW1lbnQ/LmRvY3VtZW50RWxlbWVudCA6IG51bGw7XG5leHBvcnQgY29uc3Qgc2V0QXR0cmlidXRlc0lmTnVsbCA9IChlbGVtZW50LCBhdHRycyA9IHt9KT0+e1xuICAgIGlmICghYXR0cnMgfHwgKHR5cGVvZiBhdHRycyAhPSBcIm9iamVjdFwiKSB8fCAhZWxlbWVudCkgcmV0dXJuO1xuICAgIHJldHVybiBBcnJheS5mcm9tKE9iamVjdC5lbnRyaWVzKGF0dHJzKSkubWFwKChbbmFtZSwgdmFsdWVdKT0+e1xuICAgICAgICBjb25zdCBvbGQgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShuYW1lKTtcbiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHtcbiAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKG5hbWUpO1xuICAgICAgICB9IGVsc2VcbiAgICAgICAgaWYgKHZhbHVlICE9IG9sZCkge1xuICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUobmFtZSwgb2xkID09IFwiXCIgPyAodmFsdWUgPz8gb2xkKSA6IChvbGQgPz8gdmFsdWUpKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG4vL1xuZXhwb3J0IGNvbnN0IHNldEF0dHJpYnV0ZXMgPSAoZWxlbWVudCwgYXR0cnMgPSB7fSk9PntcbiAgICByZXR1cm4gQXJyYXkuZnJvbShPYmplY3QuZW50cmllcyhhdHRycykpLm1hcCgoW25hbWUsIHZhbHVlXSk9PntcbiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHtcbiAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKG5hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUgPz8gZWxlbWVudC5nZXRBdHRyaWJ1dGUobmFtZSkpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbi8vXG5leHBvcnQgY29uc3QgdGhyb3R0bGVNYXAgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuZXhwb3J0IGNvbnN0IHNldElkbGVJbnRlcnZhbCA9IChjYiwgdGltZW91dCA9IDEwMDAsIC4uLmFyZ3MpPT57XG4gICAgY29uc3Qgc3RhdHVzID0geyBydW5uaW5nOiB0cnVlLCBjYW5jZWw6ICgpPT57IHN0YXR1cy5ydW5uaW5nID0gZmFsc2U7IH0gfTtcbiAgICByZXF1ZXN0SWRsZUNhbGxiYWNrKGFzeW5jICgpPT57XG4gICAgICAgIGlmICghY2IgfHwgKHR5cGVvZiBjYiAhPSBcImZ1bmN0aW9uXCIpKSByZXR1cm47XG4gICAgICAgIHdoaWxlIChzdGF0dXMucnVubmluZykge1xuICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoWyAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgUHJvbWlzZS50cnkoY2IsIC4uLmFyZ3MpLFxuICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKChyKT0+c2V0VGltZW91dChyLCB0aW1lb3V0KSlcbiAgICAgICAgICAgIF0pLmNhdGNoPy4oY29uc29sZS53YXJuLmJpbmQoY29uc29sZSkpO1xuXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbnkoW1xuICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKChyKT0+cmVxdWVzdElkbGVDYWxsYmFjayhyLCB7IHRpbWVvdXQgfSkpLFxuICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKChyKT0+c2V0VGltZW91dChyLCB0aW1lb3V0KSlcbiAgICAgICAgICAgICAgICAvL25ldyBQcm9taXNlKChyKT0+cmVxdWVzdEFuaW1hdGlvbkZyYW1lKHIpKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgIH1cbiAgICAgICAgc3RhdHVzLmNhbmNlbCA9ICgpPT57fTtcbiAgICB9LCB7dGltZW91dH0pO1xuICAgIHJldHVybiBzdGF0dXM/LmNhbmNlbDtcbn1cblxuLy9cbmlmICh0eXBlb2YgcmVxdWVzdEFuaW1hdGlvbkZyYW1lICE9IFwidW5kZWZpbmVkXCIpIHtcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYXN5bmMgKCkgPT4ge1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgdGhyb3R0bGVNYXAuZm9yRWFjaCgoY2IpID0+IGNiPy4oKSk7XG4gICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocikgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHIpKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG4vL1xuZXhwb3J0IGNvbnN0IGJvcmRlckJveFdpZHRoICAgPSBTeW1ib2woXCJAYm9yZGVyLWJveC13aWR0aFwiKSAsIGJvcmRlckJveEhlaWdodCAgPSBTeW1ib2woXCJAYm9yZGVyLWJveC1oZWlnaHRcIik7XG5leHBvcnQgY29uc3QgY29udGVudEJveFdpZHRoICA9IFN5bWJvbChcIkBjb250ZW50LWJveC13aWR0aFwiKSwgY29udGVudEJveEhlaWdodCA9IFN5bWJvbChcIkBjb250ZW50LWJveC1oZWlnaHRcIik7XG5leHBvcnQgY29uc3Qgb25Cb3JkZXJPYnNlcnZlICA9IG5ldyBXZWFrTWFwPEhUTUxFbGVtZW50LCBSZXNpemVPYnNlcnZlcj4oKTtcbmV4cG9ydCBjb25zdCBvbkNvbnRlbnRPYnNlcnZlID0gbmV3IFdlYWtNYXA8SFRNTEVsZW1lbnQsIFJlc2l6ZU9ic2VydmVyPigpO1xuZXhwb3J0IGNvbnN0IGRvQ29udGVudE9ic2VydmUgPSAoZWxlbWVudCwgY2I6IGFueSA9ICgpPT57fSkgPT4ge1xuICAgIGlmICghKGVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHJldHVybjtcbiAgICBpZiAoIW9uQ29udGVudE9ic2VydmUuaGFzKGVsZW1lbnQpKSB7XG4gICAgICAgIGVsZW1lbnRbY29udGVudEJveFdpZHRoXSAgPSAoZWxlbWVudC5jbGllbnRXaWR0aCApO1xuICAgICAgICBlbGVtZW50W2NvbnRlbnRCb3hIZWlnaHRdID0gKGVsZW1lbnQuY2xpZW50SGVpZ2h0KTtcblxuICAgICAgICAvL1xuICAgICAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoZW50cmllcykgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVudHJ5LmNvbnRlbnRCb3hTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRCb3hTaXplID0gZW50cnkuY29udGVudEJveFNpemVbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50Qm94U2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudFtjb250ZW50Qm94V2lkdGhdICA9IE1hdGgubWluKGNvbnRlbnRCb3hTaXplLmlubGluZVNpemUsIGVsZW1lbnQuY2xpZW50V2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudFtjb250ZW50Qm94SGVpZ2h0XSA9IE1hdGgubWluKGNvbnRlbnRCb3hTaXplLmJsb2NrU2l6ZSwgZWxlbWVudC5jbGllbnRIZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2I/LihlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9cbiAgICAgICAgb25Db250ZW50T2JzZXJ2ZS5zZXQoZWxlbWVudCwgb2JzZXJ2ZXIpO1xuICAgICAgICBvYnNlcnZlci5vYnNlcnZlKChlbGVtZW50IGFzIGFueSk/LmVsZW1lbnQgPz8gZWxlbWVudCwge2JveDogXCJjb250ZW50LWJveFwifSk7XG4gICAgfVxufTtcblxuLy9cbmV4cG9ydCBjb25zdCBkb0JvcmRlck9ic2VydmUgPSAoZWxlbWVudCwgY2I6IGFueSA9ICgpPT57fSkgPT4ge1xuICAgIGlmICghKGVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHJldHVybjtcbiAgICBpZiAoIW9uQm9yZGVyT2JzZXJ2ZS5oYXMoZWxlbWVudCkpIHtcbiAgICAgICAgZWxlbWVudFtib3JkZXJCb3hXaWR0aF0gID0gZWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICAgICAgZWxlbWVudFtib3JkZXJCb3hIZWlnaHRdID0gZWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKChlbnRyaWVzKSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZW50cnkuYm9yZGVyQm94U2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBib3JkZXJCb3hTaXplID0gZW50cnkuYm9yZGVyQm94U2l6ZVswXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJvcmRlckJveFNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRbYm9yZGVyQm94V2lkdGhdICA9IE1hdGgubWluKGJvcmRlckJveFNpemUuaW5saW5lU2l6ZSwgZWxlbWVudC5vZmZzZXRXaWR0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50W2JvcmRlckJveEhlaWdodF0gPSBNYXRoLm1pbihib3JkZXJCb3hTaXplLmJsb2NrU2l6ZSwgZWxlbWVudC5vZmZzZXRIZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2I/LihlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9cbiAgICAgICAgb25Cb3JkZXJPYnNlcnZlLnNldChlbGVtZW50LCBvYnNlcnZlcik7XG4gICAgICAgIG9ic2VydmVyLm9ic2VydmUoKGVsZW1lbnQgYXMgYW55KT8uZWxlbWVudCA/PyBlbGVtZW50LCB7Ym94OiBcImJvcmRlci1ib3hcIn0pO1xuICAgIH1cbn1cblxuLy9cbmV4cG9ydCBjb25zdCB1cmwgID0gKHR5cGU6IHN0cmluZywgLi4uc291cmNlOiBhbnlbXSkgPT4geyByZXR1cm4gVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihzb3VyY2UsIHt0eXBlfSkpOyB9O1xuZXhwb3J0IGNvbnN0IGh0bWwgPSAoc291cmNlOiBzdHJpbmcsIHR5cGU6IERPTVBhcnNlclN1cHBvcnRlZFR5cGUgPSAndGV4dC9odG1sJykgPT4ge1xuICAgIGNvbnN0IHBhcnNlZCAgPSAobmV3IERPTVBhcnNlcigpKS5wYXJzZUZyb21TdHJpbmcoc291cmNlLCB0eXBlKTtcbiAgICByZXR1cm4gcGFyc2VkLnF1ZXJ5U2VsZWN0b3IoJ3RlbXBsYXRlJykgPz8gcGFyc2VkLnF1ZXJ5U2VsZWN0b3IoXCIqXCIpO1xufTtcblxuLy9cbmV4cG9ydCBjb25zdCBzZXRDaGVja2VkID0gKGlucHV0OiBIVE1MSW5wdXRFbGVtZW50LCB2YWx1ZTogYm9vbGVhbiwgZXY/OiBhbnkpPT57XG4gICAgaWYgKHZhbHVlICE9IG51bGwgJiYgaW5wdXQuY2hlY2tlZCAhPSB2YWx1ZSkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICAoaW5wdXQ/LlsndHlwZSddID09IFwiY2hlY2tib3hcIikgfHxcbiAgICAgICAgICAgIChpbnB1dD8uWyd0eXBlJ10gPT0gXCJyYWRpb1wiICYmICFpbnB1dD8uY2hlY2tlZClcbiAgICAgICAgKSB7IGlucHV0Py5jbGljaz8uKCk7IGV2Py5wcmV2ZW50RGVmYXVsdD8uKCk7IH0gZWxzZSB7XG4gICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gISF2YWx1ZTtcbiAgICAgICAgICAgIGlucHV0Py5kaXNwYXRjaEV2ZW50Py4obmV3IEV2ZW50KFwiY2hhbmdlXCIsIHsgYnViYmxlczogdHJ1ZSwgY2FuY2VsYWJsZTogdHJ1ZSwgfSkpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5cblxuLy9cbmV4cG9ydCBjb25zdCBpc1ZhbGlkUGFyZW50ID0gKHBhcmVudDogTm9kZSB8IG51bGwpID0+IHtcbiAgICByZXR1cm4gKHBhcmVudCAhPSBudWxsICYmIHBhcmVudCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ICYmICEocGFyZW50IGluc3RhbmNlb2YgRG9jdW1lbnRGcmFnbWVudCB8fCBwYXJlbnQgaW5zdGFuY2VvZiBIVE1MQm9keUVsZW1lbnQpKSA/IHBhcmVudCA6IG51bGw7XG59XG5cbi8vXG5leHBvcnQgY29uc3QgaW5kZXhPZiA9IChlbGVtZW50OiBOb2RlIHwgbnVsbCwgbm9kZTogTm9kZSB8IG51bGwpID0+IHtcbiAgICBpZiAoZWxlbWVudCA9PSBudWxsIHx8IG5vZGUgPT0gbnVsbCkgcmV0dXJuIC0xO1xuICAgIHJldHVybiBBcnJheS5mcm9tKGVsZW1lbnQ/LmNoaWxkTm9kZXMgPz8gW10pPy5pbmRleE9mPy4oKG5vZGUgYXMgQ2hpbGROb2RlKSkgPz8gLTE7XG59XG5cbi8vXG5leHBvcnQgY29uc3RcbiAgICBNQVRDSCA9ICcoLT9bX2EtekEtWl0rW19hLXpBLVowLTktXSopJyxcbiAgICBSRUdFWCA9ICdeKD86JyArIE1BVENIICsgJyl8XiMnICsgTUFUQ0ggKyAnfF5cXFxcLicgKyBNQVRDSCArICd8XlxcXFxbJyArIE1BVENIICsgJyg/OihbKiR8fl5dPz0pKFtcIlxcJ10pKCg/Oig/PShcXFxcXFxcXD8pKVxcXFw4LikqPylcXFxcNik/XFxcXF0nO1xuXG4vL1xuZXhwb3J0IGNvbnN0IGNyZWF0ZUVsZW1lbnRWYW5pbGxhID0gKHNlbGVjdG9yKTogSFRNTEVsZW1lbnQgfCBEb2N1bWVudEZyYWdtZW50ID0+IHtcbiAgICBpZiAoc2VsZWN0b3IgPT0gXCI6ZnJhZ21lbnQ6XCIpIHJldHVybiBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgY29uc3QgY3JlYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudC5iaW5kKGRvY3VtZW50KTtcbiAgICBmb3IgKHZhciBub2RlOiBhbnkgPSBjcmVhdGUoJ2RpdicpLCBtYXRjaCwgY2xhc3NOYW1lID0gJyc7IHNlbGVjdG9yICYmIChtYXRjaCA9IHNlbGVjdG9yLm1hdGNoKFJFR0VYKSk7KSB7XG4gICAgICAgIGlmIChtYXRjaFsxXSkgbm9kZSA9IGNyZWF0ZShtYXRjaFsxXSk7XG4gICAgICAgIGlmIChtYXRjaFsyXSkgbm9kZS5pZCA9IG1hdGNoWzJdO1xuICAgICAgICBpZiAobWF0Y2hbM10pIGNsYXNzTmFtZSArPSAnICcgKyBtYXRjaFszXTtcbiAgICAgICAgaWYgKG1hdGNoWzRdKSBub2RlLnNldEF0dHJpYnV0ZShtYXRjaFs0XSwgbWF0Y2hbN10gfHwgJycpO1xuICAgICAgICBzZWxlY3RvciA9IHNlbGVjdG9yLnNsaWNlKG1hdGNoWzBdLmxlbmd0aCk7XG4gICAgfVxuICAgIGlmIChjbGFzc05hbWUpIG5vZGUuY2xhc3NOYW1lID0gY2xhc3NOYW1lLnNsaWNlKDEpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxuLy9cbmV4cG9ydCBjb25zdCBpc0VsZW1lbnQgPSAoZWw6IGFueSkgPT4geyByZXR1cm4gZWwgIT0gbnVsbCAmJiAoZWwgaW5zdGFuY2VvZiBOb2RlIHx8IGVsIGluc3RhbmNlb2YgVGV4dCB8fCBlbCBpbnN0YW5jZW9mIEVsZW1lbnQgfHwgZWwgaW5zdGFuY2VvZiBDb21tZW50IHx8IGVsIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgfHwgZWwgaW5zdGFuY2VvZiBEb2N1bWVudEZyYWdtZW50KSA/IGVsIDogbnVsbDsgfVxuZXhwb3J0IGNvbnN0IGluY2x1ZGVTZWxmID0gKHRhcmdldDogSFRNTEVsZW1lbnQsIHNlbGVjdG9yOiBzdHJpbmcpID0+IHsgcmV0dXJuICh0YXJnZXQucXVlcnlTZWxlY3RvcihzZWxlY3RvcikgPz8gKHRhcmdldC5tYXRjaGVzKHNlbGVjdG9yKSA/IHRhcmdldCA6IG51bGwpKTsgfVxuZXhwb3J0IGNvbnN0IGhhc1BhcmVudCA9IChjdXJyZW50OiBhbnksIHBhcmVudDogYW55KSA9PiB7IHdoaWxlIChjdXJyZW50KSB7IGlmICghKGN1cnJlbnQ/LmVsZW1lbnQgPz8gY3VycmVudCkpIHsgcmV0dXJuIGZhbHNlOyB9OyBpZiAoKGN1cnJlbnQ/LmVsZW1lbnQgPz8gY3VycmVudCkgPT09IChwYXJlbnQ/LmVsZW1lbnQgPz8gcGFyZW50KSkgcmV0dXJuIHRydWU7IGN1cnJlbnQgPSBjdXJyZW50LnBhcmVudEVsZW1lbnQgPz8gKGN1cnJlbnQucGFyZW50Tm9kZSA9PSBjdXJyZW50Py5nZXRSb290Tm9kZT8uKHsgY29tcG9zZWQ6IHRydWUgfSkgPyBjdXJyZW50Py5nZXRSb290Tm9kZT8uKHsgY29tcG9zZWQ6IHRydWUgfSk/Lmhvc3QgOiBjdXJyZW50Py5wYXJlbnROb2RlKTsgfSB9XG5leHBvcnQgY29uc3QgcGFzc2l2ZU9wdHMgPSB7fTtcblxuLy9cbmV4cG9ydCBmdW5jdGlvbiBhZGRFdmVudCh0YXJnZXQsIHR5cGUsIGNiLCBvcHRzOiBhbnkgPSBwYXNzaXZlT3B0cyk6IGFueSB7XG4gICAgdGFyZ2V0Py5hZGRFdmVudExpc3RlbmVyPy4odHlwZSwgY2IsIG9wdHMpO1xuICAgIGNvbnN0IHdyID0gKHR5cGVvZiB0YXJnZXQgPT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgdGFyZ2V0ID09IFwiZnVuY3Rpb25cIiAmJiAhdGFyZ2V0Py5kZXJlZikgPyBuZXcgV2Vha1JlZih0YXJnZXQpIDogdGFyZ2V0O1xuICAgIHJldHVybiAoKSA9PiB3cj8uZGVyZWY/LigpPy5yZW1vdmVFdmVudExpc3RlbmVyPy4odHlwZSwgY2IsIG9wdHMpO1xuICAgIC8vcmV0dXJuICgpID0+IHRhcmdldD8ucmVtb3ZlRXZlbnRMaXN0ZW5lcj8uKHR5cGUsIGNiLCBvcHRzKTtcbn1cblxuLy9cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmVFdmVudCh0YXJnZXQsIHR5cGUsIGNiLCBvcHRzOiBhbnkgPSBwYXNzaXZlT3B0cyk6IGFueSB7XG4gICAgdGFyZ2V0Py5yZW1vdmVFdmVudExpc3RlbmVyPy4odHlwZSwgY2IsIG9wdHMpO1xufVxuXG4vLyBhZGQgZXZlbnRzIGJ5IG1hcCBvZiBbbmFtZSwgY2JdIGluICdoYW5kbGVycydcbi8vIHdoZXJlIGNiIGlzIEZ1bmN0aW9uIG9yIFtGdW5jdGlvbiwgb3B0aW9uc11cbmV4cG9ydCBjb25zdCBhZGRFdmVudHMgPSAocm9vdCwgaGFuZGxlcnMpID0+IHtcbiAgICByb290ID0gKHJvb3QgaW5zdGFuY2VvZiBXZWFrUmVmID8gcm9vdC5kZXJlZigpIDogcm9vdCk7IC8vIEB0cy1pZ25vcmVcbiAgICByZXR1cm4gWy4uLk9iamVjdC5lbnRyaWVzKGhhbmRsZXJzKV0/Lm1hcD8uKChbbmFtZSwgY2JdKSA9PiAoQXJyYXkuaXNBcnJheShjYikgPyBhZGRFdmVudChyb290LCBuYW1lLCAuLi5jYiBhcyBhbnkpIDogYWRkRXZlbnQocm9vdCwgbmFtZSwgY2IpKSk7XG59XG5cbi8vIGFkZCBldmVudHMgYnkgbWFwIG9mIFtuYW1lLCBjYnNbXV0gaW4gJ2V2ZW50cydcbi8vIHdoZXJlIGNiIG9mIGNic1tdIGlzIEZ1bmN0aW9uIG9yIFtGdW5jdGlvbiwgb3B0aW9uc11cbi8vIGhvd2V2ZXIsIFtGdW5jdGlvbiwgb3B0aW9uc10gbm90IGltcGxlbWVudGVkIHlldFxuZXhwb3J0IGNvbnN0IGFkZEV2ZW50c0xpc3QgPSAoZWwsIGV2ZW50cykgPT4ge1xuICAgIGlmIChldmVudHMpIHtcbiAgICAgICAgbGV0IGVudHJpZXM6IGFueVtdID0gZXZlbnRzO1xuICAgICAgICBpZiAoZXZlbnRzIGluc3RhbmNlb2YgTWFwKSB7XG4gICAgICAgICAgICBlbnRyaWVzID0gWy4uLmV2ZW50cy5lbnRyaWVzKCldO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZW50cmllcyA9IFsuLi5PYmplY3QuZW50cmllcyhldmVudHMpXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZW50cmllcy5tYXAoKFtuYW1lLCBsaXN0XSkgPT4gKChpc0FycmF5T3JJdGVyYWJsZShsaXN0KSA/IFsuLi5saXN0IGFzIGFueV0gOiBsaXN0KSA/PyBbXSk/Lm1hcD8uKChjYnMpPT57XG4gICAgICAgICAgICByZXR1cm4gYWRkRXZlbnQoZWwsIG5hbWUsIGNicylcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuLy9cbmV4cG9ydCBjb25zdCByZW1vdmVFdmVudHMgPSAocm9vdCwgaGFuZGxlcnMpID0+IHtcbiAgICByb290ID0gKHJvb3QgaW5zdGFuY2VvZiBXZWFrUmVmID8gcm9vdC5kZXJlZigpIDogcm9vdCk7IC8vIEB0cy1pZ25vcmVcbiAgICByZXR1cm4gWy4uLk9iamVjdC5lbnRyaWVzKGhhbmRsZXJzKV0/Lm1hcD8uKChbbmFtZSwgY2JdKSA9PiAoQXJyYXkuaXNBcnJheShjYikgPyByZW1vdmVFdmVudChyb290LCBuYW1lLCAuLi5jYiBhcyBhbnkpIDogcmVtb3ZlRXZlbnQocm9vdCwgbmFtZSwgY2IpKSk7XG59XG5cbi8vXG4vLyBHZXQgdGhlIGFjdHVhbCB0YXJnZXQgZWxlbWVudCBmcm9tIGFuIGV2ZW50LCBjb25zaWRlcmluZyBzaGFkb3cgRE9NIGJvdW5kYXJpZXNcbmV4cG9ydCBjb25zdCBnZXRFdmVudFRhcmdldCA9IChldjogRXZlbnQgfCBhbnkpOiBIVE1MRWxlbWVudCB8IEVsZW1lbnQgfCBudWxsID0+IHtcbiAgICBpZiAoIWV2KSByZXR1cm4gbnVsbDtcblxuICAgIC8vIFVzZSBjb21wb3NlZFBhdGgoKSBmb3Igc2hhZG93IERPTSBjb21wYXRpYmlsaXR5XG4gICAgaWYgKGV2Py5jb21wb3NlZFBhdGggJiYgdHlwZW9mIGV2LmNvbXBvc2VkUGF0aCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBjb25zdCBwYXRoID0gZXYuY29tcG9zZWRQYXRoKCk7XG4gICAgICAgIC8vIFJldHVybiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgcGF0aCAodGhlIGFjdHVhbCB0YXJnZXQpXG4gICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBwYXRoKSB7XG4gICAgICAgICAgICBpZiAobm9kZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50IHx8IG5vZGUgaW5zdGFuY2VvZiBFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGYWxsYmFjayB0byB0YXJnZXQgcHJvcGVydHlcbiAgICBjb25zdCB0YXJnZXQgPSBldj8udGFyZ2V0O1xuICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCB8fCB0YXJnZXQgaW5zdGFuY2VvZiBFbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG59O1xuXG4vL1xuZXhwb3J0IGNvbnN0IGNvbnRhaW5zT3JTZWxmID0gKGE6IGFueSwgYjogYW55LCBldj86IEV2ZW50KT0+e1xuICAgIGlmIChiID09IG51bGwgfHwgIShiIGluc3RhbmNlb2YgTm9kZSkgJiYgYj8uZWxlbWVudCA9PSBudWxsKSByZXR1cm4gZmFsc2U7IC8vIGlmIGlzbid0IG5vZGUgd2l0aCBlbGVtZW50IG9yIGp1c3QgbnVsbFxuICAgIGlmICgoYSA9PSBiKSAgfHwgKGE/LmVsZW1lbnQgPz8gYSkgPT0gKGI/LmVsZW1lbnQgPz8gYikpIHJldHVybiB0cnVlOyAvLyB3cmFwcGVyIG9yIGVsZW1lbnQgaXMgc2FtZVxuXG4gICAgLy8gVXNlIGNvbXBvc2VkUGF0aCgpIGZvciBzaGFkb3cgRE9NIGNvbXBhdGliaWxpdHkgaWYgZXZlbnQgaXMgcHJvdmlkZWRcbiAgICBpZiAoZXY/LmNvbXBvc2VkUGF0aCAmJiB0eXBlb2YgZXYuY29tcG9zZWRQYXRoID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSBldi5jb21wb3NlZFBhdGgoKTtcbiAgICAgICAgY29uc3QgYUVsID0gYT8uZWxlbWVudCA/PyBhO1xuICAgICAgICBjb25zdCBiRWwgPSBiPy5lbGVtZW50ID8/IGI7XG4gICAgICAgIGlmIChwYXRoLmluY2x1ZGVzKGFFbCkgJiYgcGF0aC5pbmNsdWRlcyhiRWwpKSB7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiBiIGFwcGVhcnMgYmVmb3JlIGEgaW4gdGhlIHBhdGggKGIgaXMgZGVlcGVyL2NoaWxkIG9mIGEpXG4gICAgICAgICAgICBjb25zdCBhSW5kZXggPSBwYXRoLmluZGV4T2YoYUVsKTtcbiAgICAgICAgICAgIGNvbnN0IGJJbmRleCA9IHBhdGguaW5kZXhPZihiRWwpO1xuICAgICAgICAgICAgaWYgKGJJbmRleCA+PSAwICYmIGFJbmRleCA+PSAwICYmIGJJbmRleCA8IGFJbmRleCkgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoYT8uY29udGFpbnM/LihiPy5lbGVtZW50ID8/IGIpIHx8IGE/LmdldFJvb3ROb2RlKHsgY29tcG9zZWQ6IHRydWUgfSk/Lmhvc3QgPT0gKGI/LmVsZW1lbnQgPz8gYikpIHJldHVybiB0cnVlOyAvLyBhIGNvbnRhaW5zIGIgZWxlbWVudFxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuLy8gZ2V0IGJ5IHNlbGVjdG9yIHNlbGYgb3IgcGFyZW50LCBtYXRjaGVzIGJ5IHNlbGVjdG9yLCBpbmNsdWRlIHNoYWRvdyBET00gaG9zdFxuZXhwb3J0IGNvbnN0IE1PQ0VsZW1lbnQgPSAoZWxlbWVudDogSFRNTEVsZW1lbnQgfCBudWxsLCBzZWxlY3Rvcjogc3RyaW5nLCBldj86IEV2ZW50KTogSFRNTEVsZW1lbnQgfCBudWxsID0+IHtcbiAgICAvLyBVc2UgY29tcG9zZWRQYXRoKCkgZm9yIHNoYWRvdyBET00gY29tcGF0aWJpbGl0eSBpZiBldmVudCBpcyBwcm92aWRlZFxuICAgIGlmIChldj8uY29tcG9zZWRQYXRoICYmIHR5cGVvZiBldi5jb21wb3NlZFBhdGggPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY29uc3QgcGF0aCA9IGV2LmNvbXBvc2VkUGF0aCgpO1xuICAgICAgICAvLyBTZWFyY2ggdGhyb3VnaCB0aGUgY29tcG9zZWQgcGF0aCBmb3IgbWF0Y2hpbmcgZWxlbWVudHNcbiAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIHBhdGgpIHtcbiAgICAgICAgICAgIGlmIChub2RlIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgfHwgbm9kZSBpbnN0YW5jZW9mIEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoKG5vZGUgYXMgSFRNTEVsZW1lbnQpLm1hdGNoZXM/LihzZWxlY3RvcikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3Qgc2VsZiA9IChlbGVtZW50Py5tYXRjaGVzPy4oc2VsZWN0b3IpID8gZWxlbWVudCA6IG51bGwpO1xuICAgIGNvbnN0IGhvc3QgPSAoZWxlbWVudD8uZ2V0Um9vdE5vZGUoeyBjb21wb3NlZDogdHJ1ZSB9KSBhcyBhbnkgPz8gZWxlbWVudD8ucGFyZW50RWxlbWVudD8uZ2V0Um9vdE5vZGUoeyBjb21wb3NlZDogdHJ1ZX0pIGFzIGFueSk/Lmhvc3Q7XG4gICAgY29uc3QgaG9zdE1hdGNoZWQgPSBob3N0Py5tYXRjaGVzPy4oc2VsZWN0b3IpID8gaG9zdCA6IG51bGw7XG4gICAgY29uc3QgY2xvc2VzdCA9IChlbGVtZW50IGFzIGFueSk/LmNsb3Nlc3Q/LihzZWxlY3RvcikgPz8gKHNlbGYgYXMgYW55KT8uY2xvc2VzdD8uKHNlbGVjdG9yKSA/PyAoaG9zdE1hdGNoZWQgYXMgYW55KT8uY2xvc2VzdD8uKHNlbGVjdG9yKSA/PyBudWxsO1xuICAgIHJldHVybiAoc2VsZiA/PyBjbG9zZXN0ID8/IGhvc3RNYXRjaGVkKTtcbn07XG5cbi8vXG5leHBvcnQgY29uc3QgTU9DID0gKGVsZW1lbnQ6IEhUTUxFbGVtZW50IHwgbnVsbCwgc2VsZWN0b3I6IHN0cmluZyk6IGJvb2xlYW4gPT4geyByZXR1cm4gISFNT0NFbGVtZW50KGVsZW1lbnQsIHNlbGVjdG9yKTsgfTtcblxuLy9cbmV4cG9ydCBjb25zdCBpc0luRm9jdXMgPSAoZWxlbWVudDogSFRNTEVsZW1lbnQgfCBudWxsLCBzZWxlY3Rvck9yRWxlbWVudD86IHN0cmluZyB8IEhUTUxFbGVtZW50LCBkaXI6IFwicGFyZW50XCIgfCBcImNoaWxkXCIgPSBcInBhcmVudFwiKTogYm9vbGVhbiA9PiB7XG4gICAgaWYgKCFlbGVtZW50KSByZXR1cm4gZmFsc2U7XG5cbiAgICAvLyBWaXNpYmlsaXR5IENoZWNrIChpZiBzdXBwb3J0ZWQsIG90aGVyd2lzZSBiYXNpYyBvZmZzZXRQYXJlbnQpXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGlmIChlbGVtZW50LmNoZWNrVmlzaWJpbGl0eSAmJiAhZWxlbWVudC5jaGVja1Zpc2liaWxpdHkoeyBjaGVja09wYWNpdHk6IHRydWUsIGNoZWNrVmlzaWJpbGl0eUNTUzogdHJ1ZSB9KSkgcmV0dXJuIGZhbHNlO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBpZiAoIWVsZW1lbnQuY2hlY2tWaXNpYmlsaXR5ICYmIGVsZW1lbnQub2Zmc2V0UGFyZW50ID09PSBudWxsICYmIGVsZW1lbnQuc3R5bGUucG9zaXRpb24gIT09ICdmaXhlZCcpIHJldHVybiBmYWxzZTtcblxuICAgIC8vIERlZXAgQWN0aXZlIEVsZW1lbnQgUmVzb2x1dGlvblxuICAgIGxldCBhY3RpdmUgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuICAgIHdoaWxlIChhY3RpdmUgJiYgYWN0aXZlLnNoYWRvd1Jvb3QgJiYgYWN0aXZlLnNoYWRvd1Jvb3QuYWN0aXZlRWxlbWVudCkge1xuICAgICAgICBhY3RpdmUgPSBhY3RpdmUuc2hhZG93Um9vdC5hY3RpdmVFbGVtZW50O1xuICAgIH1cblxuICAgIC8vIEludGVyYWN0aW9uIFN0YXR1c1xuICAgIGNvbnN0IGlzRm9jdXNlZCA9IChhY3RpdmUgPT09IGVsZW1lbnQpIHx8IGhhc1BhcmVudChhY3RpdmUsIGVsZW1lbnQpO1xuICAgIGNvbnN0IGlzSG92ZXJlZCA9IGVsZW1lbnQubWF0Y2hlcyhcIjpob3ZlclwiKTtcblxuICAgIC8vIFRvcC1tb3N0IGNoZWNrIGZvciBob3ZlciAob3B0aW9uYWwsIGJ1dCByZXF1ZXN0ZWQgXCJlbGVtZW50RnJvbVBvaW50XCIpXG4gICAgLy8gT25seSB3b3J0aCBjaGVja2luZyBpZiBob3ZlcmVkIGJ1dCBub3QgZm9jdXNlZCwgdG8gc2VlIGlmIGl0J3Mgb2NjbHVkZWQ/XG4gICAgLy8gU2tpcHBpbmcgZXhwZW5zaXZlIHJlY3QgY2FsYyBmb3Igbm93IHVubGVzcyBzdHJpY3RseSBuZWVkZWQsIDpob3ZlciBpcyB1c3VhbGx5IHJlbGlhYmxlIGZvciBDU1MgcG9pbnRlci1ldmVudHMuXG5cbiAgICBpZiAoIWlzRm9jdXNlZCAmJiAhaXNIb3ZlcmVkICYmICFzZWxlY3Rvck9yRWxlbWVudCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgLy8gQ29uc3RyYWludHNcbiAgICBpZiAoc2VsZWN0b3JPckVsZW1lbnQpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBzZWxlY3Rvck9yRWxlbWVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgaWYgKGRpciA9PT0gXCJwYXJlbnRcIikge1xuICAgICAgICAgICAgICAgIC8vIERvZXMgdGhlIGVsZW1lbnQgKG9yIGl0cyBjb250ZXh0KSBtYXRjaCB0aGUgc2VsZWN0b3I/XG4gICAgICAgICAgICAgICAgcmV0dXJuICEhTU9DRWxlbWVudChlbGVtZW50LCBzZWxlY3Rvck9yRWxlbWVudCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIERvZXMgdGhlIGludGVyYWN0aW9uIHRhcmdldCBpbnNpZGUgbWF0Y2ggdGhlIHNlbGVjdG9yP1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGlzRm9jdXNlZCA/IGFjdGl2ZSA6IChlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCI6aG92ZXJcIikgfHwgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgY29uc3QgYWx0Q25kID0gISFNT0NFbGVtZW50KHRhcmdldCBhcyBIVE1MRWxlbWVudCwgc2VsZWN0b3JPckVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHJldHVybiAoZWxlbWVudD8ucXVlcnlTZWxlY3Rvcj8uKHNlbGVjdG9yT3JFbGVtZW50KSAhPSBudWxsIHx8IGVsZW1lbnQ/Lm1hdGNoZXM/LihzZWxlY3Rvck9yRWxlbWVudCkgfHwgYWx0Q25kKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChzZWxlY3Rvck9yRWxlbWVudCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7XG4gICAgICAgICAgICAgaWYgKGRpciA9PT0gXCJwYXJlbnRcIikge1xuICAgICAgICAgICAgICAgICByZXR1cm4gaGFzUGFyZW50KGVsZW1lbnQsIHNlbGVjdG9yT3JFbGVtZW50KSB8fCBmYWxzZTtcbiAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICByZXR1cm4gaGFzUGFyZW50KHNlbGVjdG9yT3JFbGVtZW50LCBlbGVtZW50KSB8fCBmYWxzZTtcbiAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbiJdfQ==