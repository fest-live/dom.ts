const onBorderObserve = new WeakMap(), onContentObserve = new WeakMap();
const unwrapFromQuery = (element) => { if (typeof element?.current == "object") {
    element = element?.element ?? element?.current ?? (typeof element?.self == "object" ? element?.self : null) ?? element;
} ; return element; };
// TODO: support of fragments
export const observeContentBox = (element, cb) => {
    if (!onContentObserve.has(element = unwrapFromQuery(element))) {
        const callbacks = [];
        const observer = new ResizeObserver((entries) => {
            for (const entry of entries) {
                if (entry.contentBoxSize) {
                    const contentBoxSize = entry.contentBoxSize[0];
                    if (contentBoxSize) {
                        callbacks.forEach((cb) => cb?.(contentBoxSize, observer));
                    }
                }
            }
        });
        //
        cb?.({
            inlineSize: element.clientWidth /* - (getPxValue(element, "padding-left") + getPxValue(element, "padding-right"))*/,
            blockSize: element.clientHeight /* - (getPxValue(element, "padding-top") + getPxValue(element, "padding-bottom"))*/,
        }, observer);
        //
        onContentObserve.set(element, callbacks);
        if ((element?.element ?? element) instanceof Node) {
            observer.observe(element?.element ?? element, { box: "content-box" });
        }
    }
    //
    onContentObserve.get(element)?.push?.(cb);
    return { disconnect: () => (onContentObserve.get(element)?.splice?.(onContentObserve.get(element)?.indexOf(cb) || -1, 1)) };
};
// TODO: support of fragments
export const observeBorderBox = (element, cb) => {
    if (!onBorderObserve.has(element = unwrapFromQuery(element))) {
        const callbacks = [];
        const observer = new ResizeObserver((entries) => {
            for (const entry of entries) {
                if (entry.borderBoxSize) {
                    const borderBoxSize = entry.borderBoxSize[0];
                    if (borderBoxSize) {
                        callbacks.forEach((cb) => cb?.(borderBoxSize, observer));
                    }
                }
            }
        });
        //
        cb?.({
            inlineSize: element.offsetWidth,
            blockSize: element.offsetHeight,
        }, observer);
        //
        onBorderObserve.set(element, callbacks);
        if ((element?.element ?? element) instanceof Node) {
            observer.observe(element?.element ?? element, { box: "border-box" });
        }
    }
    //
    onBorderObserve.get(element)?.push?.(cb);
    return { disconnect: () => (onBorderObserve.get(element)?.splice?.(onBorderObserve.get(element)?.indexOf(cb) || -1, 1)) };
};
/*
    const config = {
        attributeFilter: [attribute],
        attributeOldValue: true,
        attributes: true,
        childList: false,
        subtree: false,
    };
*/
//
export const observeAttribute = (element, attribute, cb) => {
    if (typeof element?.selector == "string") {
        return observeAttributeBySelector(element, element?.selector, attribute, cb);
    }
    ;
    //
    const attributeList = new Set((attribute.split(",") || [attribute]).map((s) => s.trim()));
    const observer = new MutationObserver((mutationList, observer) => {
        for (const mutation of mutationList) {
            if (mutation.attributeName && attributeList.has(mutation.attributeName)) {
                cb(mutation, observer);
            }
        }
    });
    //
    if ((element?.element ?? element) instanceof Node) {
        observer.observe(element = unwrapFromQuery(element), { attributes: true, attributeOldValue: true, attributeFilter: [...attributeList] });
    }
    attributeList.forEach((attribute) => cb({ target: element, type: "attributes", attributeName: attribute, oldValue: element?.getAttribute?.(attribute) }, observer));
    return observer;
};
//
export const observeAttributeBySelector = (element, selector, attribute, cb) => {
    const attributeList = new Set([...(attribute.split(",") || [attribute])].map((s) => s.trim()));
    const observer = new MutationObserver((mutationList, observer) => {
        for (const mutation of mutationList) {
            if (mutation.type == "childList") {
                const addedNodes = Array.from(mutation.addedNodes) || [];
                const removedNodes = Array.from(mutation.removedNodes) || [];
                //
                addedNodes.push(...Array.from(mutation.addedNodes || []).flatMap((el) => Array.from(el?.querySelectorAll?.(selector) || [])));
                removedNodes.push(...Array.from(mutation.removedNodes || []).flatMap((el) => Array.from(el?.querySelectorAll?.(selector) || [])));
                //
                [...new Set(addedNodes)]?.filter((el) => el?.matches?.(selector))?.map?.((target) => {
                    attributeList.forEach((attribute) => {
                        cb({ target, type: "attributes", attributeName: attribute, oldValue: target?.getAttribute?.(attribute) }, observer);
                    });
                });
            }
            else if (mutation.target?.matches?.(selector) && (mutation.attributeName && attributeList.has(mutation.attributeName))) {
                cb(mutation, observer);
            }
        }
    });
    //
    observer.observe(element = unwrapFromQuery(element), {
        attributeOldValue: true,
        attributes: true,
        attributeFilter: [...attributeList],
        childList: true,
        subtree: true,
        characterData: true
    });
    //
    [...element.querySelectorAll(selector)].map((target) => attributeList.forEach((attribute) => cb({ target, type: "attributes", attributeName: attribute, oldValue: target?.getAttribute?.(attribute) }, observer)));
    return observer;
};
//
export const observeBySelector = (element, selector = "*", cb = (mut, obs) => { }) => {
    const unwrapNodesBySelector = (nodes) => {
        const $nodes = Array.from(nodes || []) || [];
        $nodes.push(...Array.from(nodes || []).flatMap((el) => Array.from(el?.querySelectorAll?.(selector) || [])));
        return [...Array.from((new Set($nodes)).values())].filter((el) => el?.matches?.(selector));
    };
    //
    const handleMutation = (mutation) => {
        const observer = obRef?.deref?.();
        const addedNodes = unwrapNodesBySelector(mutation.addedNodes);
        const removedNodes = unwrapNodesBySelector(mutation.removedNodes);
        //
        if (addedNodes.length > 0 || removedNodes.length > 0) {
            cb?.({
                type: mutation.type,
                target: mutation.target,
                attributeName: mutation.attributeName,
                attributeNamespace: mutation.attributeNamespace,
                nextSibling: mutation.nextSibling,
                oldValue: mutation.oldValue,
                previousSibling: mutation.previousSibling,
                addedNodes, removedNodes,
            }, observer);
        }
    };
    //
    const handleCome = (ev) => {
        handleMutation({
            addedNodes: [ev?.target].filter((el) => !!el),
            removedNodes: [ev?.relatedTarget].filter((el) => !!el),
            type: "childList",
            target: ev?.currentTarget,
        });
    };
    //
    const handleOutCome = (ev) => {
        handleMutation({
            addedNodes: [ev?.relatedTarget].filter((el) => !!el),
            removedNodes: [ev?.target].filter((el) => !!el),
            type: "childList",
            target: ev?.currentTarget,
        });
    };
    //
    const handleFocusClick = (ev) => {
        handleMutation({
            addedNodes: [ev?.target].filter((el) => !!el),
            removedNodes: [ev?.relatedTarget || document?.activeElement].filter((el) => !!el),
            type: "childList",
            target: ev?.currentTarget,
        });
    };
    // capture: false - from parents to children, true - from children to parents
    // passive: true - optimal for selector events
    const factors = {
        passive: true,
        capture: false,
    };
    //
    if (selector?.includes?.(":hover") && selector?.includes?.(":active")) {
        element.addEventListener("pointerover", handleCome, factors);
        element.addEventListener("pointerout", handleOutCome, factors);
        element.addEventListener("pointerdown", handleCome, factors);
        element.addEventListener("pointerup", handleOutCome, factors);
        element.addEventListener("pointercancel", handleOutCome, factors);
        return { disconnect: () => {
                element.removeEventListener("pointerover", handleCome, factors);
                element.removeEventListener("pointerout", handleOutCome, factors);
                element.removeEventListener("pointerdown", handleCome, factors);
                element.removeEventListener("pointerup", handleOutCome, factors);
                element.removeEventListener("pointercancel", handleOutCome, factors);
            } };
    }
    //
    if (selector?.includes?.(":hover")) {
        element.addEventListener("pointerover", handleCome, factors);
        element.addEventListener("pointerout", handleOutCome, factors);
        return { disconnect: () => {
                element.removeEventListener("pointerover", handleCome, factors);
                element.removeEventListener("pointerout", handleOutCome, factors);
            } };
    }
    //
    if (selector?.includes?.(":active")) {
        element.addEventListener("pointerdown", handleCome, factors);
        element.addEventListener("pointerup", handleOutCome, factors);
        element.addEventListener("pointercancel", handleOutCome, factors);
        return { disconnect: () => {
                element.removeEventListener("pointerdown", handleCome, factors);
                element.removeEventListener("pointerup", handleOutCome, factors);
                element.removeEventListener("pointercancel", handleOutCome, factors);
            } };
    }
    //
    if (selector?.includes?.(":focus") && selector?.includes?.(":focus-within") && selector?.includes?.(":focus-visible")) {
        element.addEventListener("focusin", handleCome, factors);
        element.addEventListener("focusout", handleOutCome, factors);
        element.addEventListener("click", handleFocusClick, factors);
        return { disconnect: () => {
                element.removeEventListener("focusin", handleCome, factors);
                element.removeEventListener("focusout", handleOutCome, factors);
                element.removeEventListener("click", handleFocusClick, factors);
            } };
    }
    //
    const observer = new MutationObserver((mutationList, observer) => {
        for (const mutation of mutationList) {
            if (mutation.type == "childList") {
                handleMutation(mutation);
            }
        }
    });
    //
    const obRef = new WeakRef(observer);
    if ((element?.element ?? element) instanceof Node) {
        observer.observe(element = unwrapFromQuery(element), { childList: true, subtree: true });
    }
    const selected = Array.from(element.querySelectorAll(selector));
    if (selected.length > 0) {
        cb?.({ addedNodes: selected }, observer);
    }
    ;
    return observer;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT2JzZXJ2ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJPYnNlcnZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFNLGVBQWUsR0FBRyxJQUFJLE9BQU8sRUFBMkIsRUFBRSxnQkFBZ0IsR0FBRyxJQUFJLE9BQU8sRUFBMkIsQ0FBQztBQUMxSCxNQUFNLGVBQWUsR0FBRyxDQUFDLE9BQVksRUFBRSxFQUFFLEdBQUcsSUFBSSxPQUFPLE9BQU8sRUFBRSxPQUFPLElBQUksUUFBUSxFQUFFLENBQUM7SUFBQyxPQUFPLEdBQUcsT0FBTyxFQUFFLE9BQU8sSUFBSSxPQUFPLEVBQUUsT0FBTyxJQUFJLENBQUMsT0FBTyxPQUFPLEVBQUUsSUFBSSxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksT0FBTyxDQUFDO0FBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQyxPQUFPLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUVuTyw2QkFBNkI7QUFDN0IsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQUcsQ0FBQyxPQUFPLEVBQUUsRUFBRSxFQUFFLEVBQUU7SUFDN0MsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxPQUFPLEdBQUcsZUFBZSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUM1RCxNQUFNLFNBQVMsR0FBZSxFQUFFLENBQUM7UUFDakMsTUFBTSxRQUFRLEdBQUcsSUFBSSxjQUFjLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUM1QyxLQUFLLE1BQU0sS0FBSyxJQUFJLE9BQU8sRUFBRSxDQUFDO2dCQUMxQixJQUFJLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztvQkFDdkIsTUFBTSxjQUFjLEdBQUcsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDL0MsSUFBSSxjQUFjLEVBQUUsQ0FBQzt3QkFDakIsU0FBUyxD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RSxFQUFFLENBQUMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFBQyxDQUFDO0lBQUEsQ0FBQztJQUN2RSxPQUFPLFFBQVEsQ0FBQztBQUNwQixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBvbkJvcmRlck9ic2VydmUgPSBuZXcgV2Vha01hcDxIVE1MRWxlbWVudCwgRnVuY3Rpb25bXT4oKSwgb25Db250ZW50T2JzZXJ2ZSA9IG5ldyBXZWFrTWFwPEhUTUxFbGVtZW50LCBGdW5jdGlvbltdPigpO1xuY29uc3QgdW53cmFwRnJvbVF1ZXJ5ID0gKGVsZW1lbnQ6IGFueSkgPT4geyBpZiAodHlwZW9mIGVsZW1lbnQ/LmN1cnJlbnQgPT0gXCJvYmplY3RcIikgeyBlbGVtZW50ID0gZWxlbWVudD8uZWxlbWVudCA/PyBlbGVtZW50Py5jdXJyZW50ID8/ICh0eXBlb2YgZWxlbWVudD8uc2VsZiA9PSBcIm9iamVjdFwiID8gZWxlbWVudD8uc2VsZiA6IG51bGwpID8/IGVsZW1lbnQ7IH07IHJldHVybiBlbGVtZW50OyB9XG5cbi8vIFRPRE86IHN1cHBvcnQgb2YgZnJhZ21lbnRzXG5leHBvcnQgY29uc3Qgb2JzZXJ2ZUNvbnRlbnRCb3ggPSAoZWxlbWVudCwgY2IpID0+IHtcbiAgICBpZiAoIW9uQ29udGVudE9ic2VydmUuaGFzKGVsZW1lbnQgPSB1bndyYXBGcm9tUXVlcnkoZWxlbWVudCkpKSB7XG4gICAgICAgIGNvbnN0IGNhbGxiYWNrczogRnVuY3Rpb25bXSA9IFtdO1xuICAgICAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoZW50cmllcykgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVudHJ5LmNvbnRlbnRCb3hTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRCb3hTaXplID0gZW50cnkuY29udGVudEJveFNpemVbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50Qm94U2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzLmZvckVhY2goKGNiKSA9PiBjYj8uKGNvbnRlbnRCb3hTaXplLCBvYnNlcnZlcikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvL1xuICAgICAgICBjYj8uKHtcbiAgICAgICAgICAgIGlubGluZVNpemU6IGVsZW1lbnQuY2xpZW50V2lkdGgvKiAtIChnZXRQeFZhbHVlKGVsZW1lbnQsIFwicGFkZGluZy1sZWZ0XCIpICsgZ2V0UHhWYWx1ZShlbGVtZW50LCBcInBhZGRpbmctcmlnaHRcIikpKi8sXG4gICAgICAgICAgICBibG9ja1NpemU6IGVsZW1lbnQuY2xpZW50SGVpZ2h0LyogLSAoZ2V0UHhWYWx1ZShlbGVtZW50LCBcInBhZGRpbmctdG9wXCIpICsgZ2V0UHhWYWx1ZShlbGVtZW50LCBcInBhZGRpbmctYm90dG9tXCIpKSovLFxuICAgICAgICB9LCBvYnNlcnZlcik7XG5cbiAgICAgICAgLy9cbiAgICAgICAgb25Db250ZW50T2JzZXJ2ZS5zZXQoZWxlbWVudCwgY2FsbGJhY2tzKTtcbiAgICAgICAgaWYgKChlbGVtZW50Py5lbGVtZW50ID8/IGVsZW1lbnQpIGluc3RhbmNlb2YgTm9kZSkge1xuICAgICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShlbGVtZW50Py5lbGVtZW50ID8/IGVsZW1lbnQsIHtib3g6IFwiY29udGVudC1ib3hcIn0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy9cbiAgICBvbkNvbnRlbnRPYnNlcnZlLmdldChlbGVtZW50KT8ucHVzaD8uKGNiKTtcbiAgICByZXR1cm4geyBkaXNjb25uZWN0OiAoKT0+KG9uQ29udGVudE9ic2VydmUuZ2V0KGVsZW1lbnQpPy5zcGxpY2U/LihvbkNvbnRlbnRPYnNlcnZlLmdldChlbGVtZW50KT8uaW5kZXhPZihjYikgfHwgLTEsIDEpKSB9O1xufTtcblxuLy8gVE9ETzogc3VwcG9ydCBvZiBmcmFnbWVudHNcbmV4cG9ydCBjb25zdCBvYnNlcnZlQm9yZGVyQm94ID0gKGVsZW1lbnQsIGNiKSA9PiB7XG4gICAgaWYgKCFvbkJvcmRlck9ic2VydmUuaGFzKGVsZW1lbnQgPSB1bndyYXBGcm9tUXVlcnkoZWxlbWVudCkpKSB7XG4gICAgICAgIGNvbnN0IGNhbGxiYWNrczogRnVuY3Rpb25bXSA9IFtdO1xuICAgICAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoZW50cmllcykgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVudHJ5LmJvcmRlckJveFNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYm9yZGVyQm94U2l6ZSA9IGVudHJ5LmJvcmRlckJveFNpemVbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChib3JkZXJCb3hTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3MuZm9yRWFjaCgoY2IpID0+IGNiPy4oYm9yZGVyQm94U2l6ZSwgb2JzZXJ2ZXIpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9cbiAgICAgICAgY2I/Lih7XG4gICAgICAgICAgICBpbmxpbmVTaXplOiBlbGVtZW50Lm9mZnNldFdpZHRoLFxuICAgICAgICAgICAgYmxvY2tTaXplOiBlbGVtZW50Lm9mZnNldEhlaWdodCxcbiAgICAgICAgfSwgb2JzZXJ2ZXIpO1xuXG4gICAgICAgIC8vXG4gICAgICAgIG9uQm9yZGVyT2JzZXJ2ZS5zZXQoZWxlbWVudCwgY2FsbGJhY2tzKTtcbiAgICAgICAgaWYgKChlbGVtZW50Py5lbGVtZW50ID8/IGVsZW1lbnQpIGluc3RhbmNlb2YgTm9kZSkge1xuICAgICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShlbGVtZW50Py5lbGVtZW50ID8/IGVsZW1lbnQsIHtib3g6IFwiYm9yZGVyLWJveFwifSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvL1xuICAgIG9uQm9yZGVyT2JzZXJ2ZS5nZXQoZWxlbWVudCk/LnB1c2g/LihjYik7XG4gICAgcmV0dXJuIHsgZGlzY29ubmVjdDogKCk9PihvbkJvcmRlck9ic2VydmUuZ2V0KGVsZW1lbnQpPy5zcGxpY2U/LihvbkJvcmRlck9ic2VydmUuZ2V0KGVsZW1lbnQpPy5pbmRleE9mKGNiKSB8fCAtMSwgMSkpIH07XG59XG5cbi8qXG4gICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBhdHRyaWJ1dGVGaWx0ZXI6IFthdHRyaWJ1dGVdLFxuICAgICAgICBhdHRyaWJ1dGVPbGRWYWx1ZTogdHJ1ZSxcbiAgICAgICAgYXR0cmlidXRlczogdHJ1ZSxcbiAgICAgICAgY2hpbGRMaXN0OiBmYWxzZSxcbiAgICAgICAgc3VidHJlZTogZmFsc2UsXG4gICAgfTtcbiovXG5cbi8vXG5leHBvcnQgY29uc3Qgb2JzZXJ2ZUF0dHJpYnV0ZSA9IChlbGVtZW50LCBhdHRyaWJ1dGUsIGNiKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBlbGVtZW50Py5zZWxlY3RvciA9PSBcInN0cmluZ1wiKSB7IHJldHVybiBvYnNlcnZlQXR0cmlidXRlQnlTZWxlY3RvcihlbGVtZW50LCBlbGVtZW50Py5zZWxlY3RvciwgYXR0cmlidXRlLCBjYik7IH07XG5cbiAgICAvL1xuICAgIGNvbnN0IGF0dHJpYnV0ZUxpc3QgPSBuZXcgU2V0PHN0cmluZz4oKGF0dHJpYnV0ZS5zcGxpdChcIixcIikgfHwgW2F0dHJpYnV0ZV0pLm1hcCgocykgPT4gcy50cmltKCkpKTtcbiAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbkxpc3QsIG9ic2VydmVyKSA9PiB7XG4gICAgICAgIGZvciAoY29uc3QgbXV0YXRpb24gb2YgbXV0YXRpb25MaXN0KSB7XG4gICAgICAgICAgICBpZiAobXV0YXRpb24uYXR0cmlidXRlTmFtZSAmJiBhdHRyaWJ1dGVMaXN0LmhhcyhtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lKSlcbiAgICAgICAgICAgICAgICB7IGNiKG11dGF0aW9uLCBvYnNlcnZlcik7IH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy9cbiAgICBpZiAoKGVsZW1lbnQ/LmVsZW1lbnQgPz8gZWxlbWVudCkgaW5zdGFuY2VvZiBOb2RlKSB7XG4gICAgICAgIG9ic2VydmVyLm9ic2VydmUoZWxlbWVudCA9IHVud3JhcEZyb21RdWVyeShlbGVtZW50KSwgeyBhdHRyaWJ1dGVzOiB0cnVlLCBhdHRyaWJ1dGVPbGRWYWx1ZTogdHJ1ZSwgYXR0cmlidXRlRmlsdGVyOiBbLi4uYXR0cmlidXRlTGlzdF0gfSk7XG4gICAgfVxuICAgIGF0dHJpYnV0ZUxpc3QuZm9yRWFjaCgoYXR0cmlidXRlKT0+Y2IoeyB0YXJnZXQ6IGVsZW1lbnQsIHR5cGU6IFwiYXR0cmlidXRlc1wiLCBhdHRyaWJ1dGVOYW1lOiBhdHRyaWJ1dGUsIG9sZFZhbHVlOiAoZWxlbWVudCBhcyBIVE1MRWxlbWVudCk/LmdldEF0dHJpYnV0ZT8uKGF0dHJpYnV0ZSkgfSwgb2JzZXJ2ZXIpKTtcbiAgICByZXR1cm4gb2JzZXJ2ZXI7XG59O1xuXG4vL1xuZXhwb3J0IGNvbnN0IG9ic2VydmVBdHRyaWJ1dGVCeVNlbGVjdG9yID0gKGVsZW1lbnQsIHNlbGVjdG9yLCBhdHRyaWJ1dGUsIGNiKSA9PiB7XG4gICAgY29uc3QgYXR0cmlidXRlTGlzdCA9IG5ldyBTZXQ8c3RyaW5nPihbLi4uKGF0dHJpYnV0ZS5zcGxpdChcIixcIikgfHwgW2F0dHJpYnV0ZV0pXS5tYXAoKHMpID0+IHMudHJpbSgpKSk7XG4gICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigobXV0YXRpb25MaXN0LCBvYnNlcnZlcikgPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IG11dGF0aW9uIG9mIG11dGF0aW9uTGlzdCkge1xuICAgICAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT0gXCJjaGlsZExpc3RcIikge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFkZGVkTm9kZXMgICA9IEFycmF5LmZyb20obXV0YXRpb24uYWRkZWROb2RlcykgICB8fCBbXTtcbiAgICAgICAgICAgICAgICBjb25zdCByZW1vdmVkTm9kZXMgPSBBcnJheS5mcm9tKG11dGF0aW9uLnJlbW92ZWROb2RlcykgfHwgW107XG5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIGFkZGVkTm9kZXMucHVzaCguLi5BcnJheS5mcm9tKG11dGF0aW9uLmFkZGVkTm9kZXMgfHwgW10pLmZsYXRNYXAoKGVsKT0+QXJyYXkuZnJvbSgoZWwgYXMgSFRNTEVsZW1lbnQpPy5xdWVyeVNlbGVjdG9yQWxsPy4oc2VsZWN0b3IpIHx8IFtdKSBhcyBFbGVtZW50W10pKTtcbiAgICAgICAgICAgICAgICByZW1vdmVkTm9kZXMucHVzaCguLi5BcnJheS5mcm9tKG11dGF0aW9uLnJlbW92ZWROb2RlcyB8fCBbXSkuZmxhdE1hcCgoZWwpPT5BcnJheS5mcm9tKChlbCBhcyBIVE1MRWxlbWVudCk/LnF1ZXJ5U2VsZWN0b3JBbGw/LihzZWxlY3RvcikgfHwgW10pIGFzIEVsZW1lbnRbXSkpO1xuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICBbLi4ubmV3IFNldChhZGRlZE5vZGVzKV0/LmZpbHRlcigoZWw6IGFueSk9PmVsPy5tYXRjaGVzPy4oc2VsZWN0b3IpKT8ubWFwPy4oKHRhcmdldCk9PntcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlTGlzdC5mb3JFYWNoKChhdHRyaWJ1dGUpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICBjYih7IHRhcmdldCwgdHlwZTogXCJhdHRyaWJ1dGVzXCIsIGF0dHJpYnV0ZU5hbWU6IGF0dHJpYnV0ZSwgb2xkVmFsdWU6ICh0YXJnZXQgYXMgSFRNTEVsZW1lbnQpPy5nZXRBdHRyaWJ1dGU/LihhdHRyaWJ1dGUpIH0sIG9ic2VydmVyKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgIGlmICgobXV0YXRpb24udGFyZ2V0IGFzIEhUTUxFbGVtZW50KT8ubWF0Y2hlcz8uKHNlbGVjdG9yKSAmJiAobXV0YXRpb24uYXR0cmlidXRlTmFtZSAmJiBhdHRyaWJ1dGVMaXN0LmhhcyhtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lKSkpIHtcbiAgICAgICAgICAgICAgICBjYihtdXRhdGlvbiwgb2JzZXJ2ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvL1xuICAgIG9ic2VydmVyLm9ic2VydmUoZWxlbWVudCA9IHVud3JhcEZyb21RdWVyeShlbGVtZW50KSwge1xuICAgICAgICBhdHRyaWJ1dGVPbGRWYWx1ZTogdHJ1ZSxcbiAgICAgICAgYXR0cmlidXRlczogdHJ1ZSxcbiAgICAgICAgYXR0cmlidXRlRmlsdGVyOiBbLi4uYXR0cmlidXRlTGlzdF0sXG4gICAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcbiAgICAgICAgc3VidHJlZTogdHJ1ZSxcbiAgICAgICAgY2hhcmFjdGVyRGF0YTogdHJ1ZVxuICAgIH0pO1xuXG4gICAgLy9cbiAgICBbLi4uZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKV0ubWFwKCh0YXJnZXQpPT5hdHRyaWJ1dGVMaXN0LmZvckVhY2goKGF0dHJpYnV0ZSk9PmNiKHsgdGFyZ2V0LCB0eXBlOiBcImF0dHJpYnV0ZXNcIiwgYXR0cmlidXRlTmFtZTogYXR0cmlidXRlLCBvbGRWYWx1ZTogKHRhcmdldCBhcyBIVE1MRWxlbWVudCk/LmdldEF0dHJpYnV0ZT8uKGF0dHJpYnV0ZSkgfSwgb2JzZXJ2ZXIpKSk7XG4gICAgcmV0dXJuIG9ic2VydmVyO1xufTtcblxuLy9cbmV4cG9ydCBjb25zdCBvYnNlcnZlQnlTZWxlY3RvciA9IChlbGVtZW50LCBzZWxlY3RvciA9IFwiKlwiLCBjYiA9IChtdXQsIG9icyk9Pnt9KSA9PiB7XG4gICAgY29uc3QgdW53cmFwTm9kZXNCeVNlbGVjdG9yID0gKG5vZGVzOiBOb2RlTGlzdE9mPEVsZW1lbnQ+KTogRWxlbWVudFtdPT57XG4gICAgICAgIGNvbnN0ICRub2RlcyA9IEFycmF5LmZyb20obm9kZXMgfHwgW10pIHx8IFtdO1xuICAgICAgICAkbm9kZXMucHVzaCguLi5BcnJheS5mcm9tKG5vZGVzIHx8IFtdKS5mbGF0TWFwKChlbCk9PiBBcnJheS5mcm9tKChlbCBhcyBIVE1MRWxlbWVudCk/LnF1ZXJ5U2VsZWN0b3JBbGw/LihzZWxlY3RvcikgfHwgW10pIGFzIEVsZW1lbnRbXSkpO1xuICAgICAgICByZXR1cm4gWy4uLkFycmF5LmZyb20oKG5ldyBTZXQoJG5vZGVzKSkudmFsdWVzKCkpXS5maWx0ZXIoKGVsKSA9PiAoPEhUTUxFbGVtZW50PmVsKT8ubWF0Y2hlcz8uKHNlbGVjdG9yKSk7XG4gICAgfVxuXG4gICAgLy9cbiAgICBjb25zdCBoYW5kbGVNdXRhdGlvbiA9IChtdXRhdGlvbik9PntcbiAgICAgICAgY29uc3Qgb2JzZXJ2ZXIgICAgICA9IG9iUmVmPy5kZXJlZj8uKCk7XG4gICAgICAgIGNvbnN0IGFkZGVkTm9kZXMgICA9IHVud3JhcE5vZGVzQnlTZWxlY3RvcihtdXRhdGlvbi5hZGRlZE5vZGVzKTtcbiAgICAgICAgY29uc3QgcmVtb3ZlZE5vZGVzID0gdW53cmFwTm9kZXNCeVNlbGVjdG9yKG11dGF0aW9uLnJlbW92ZWROb2Rlcyk7XG5cbiAgICAgICAgLy9cbiAgICAgICAgaWYgKGFkZGVkTm9kZXMubGVuZ3RoID4gMCB8fCByZW1vdmVkTm9kZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY2I/Lih7XG4gICAgICAgICAgICAgICAgdHlwZTogbXV0YXRpb24udHlwZSxcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IG11dGF0aW9uLnRhcmdldCxcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiBtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWVzcGFjZTogbXV0YXRpb24uYXR0cmlidXRlTmFtZXNwYWNlLFxuICAgICAgICAgICAgICAgIG5leHRTaWJsaW5nOiBtdXRhdGlvbi5uZXh0U2libGluZyxcbiAgICAgICAgICAgICAgICBvbGRWYWx1ZTogbXV0YXRpb24ub2xkVmFsdWUsXG4gICAgICAgICAgICAgICAgcHJldmlvdXNTaWJsaW5nOiBtdXRhdGlvbi5wcmV2aW91c1NpYmxpbmcsXG4gICAgICAgICAgICAgICAgYWRkZWROb2RlcywgcmVtb3ZlZE5vZGVzLFxuICAgICAgICAgICAgfSwgb2JzZXJ2ZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy9cbiAgICBjb25zdCBoYW5kbGVDb21lID0gKGV2KT0+e1xuICAgICAgICBoYW5kbGVNdXRhdGlvbih7XG4gICAgICAgICAgICBhZGRlZE5vZGVzOiBbZXY/LnRhcmdldF0uZmlsdGVyKChlbCk9PiEhZWwpLFxuICAgICAgICAgICAgcmVtb3ZlZE5vZGVzOiBbZXY/LnJlbGF0ZWRUYXJnZXRdLmZpbHRlcigoZWwpPT4hIWVsKSxcbiAgICAgICAgICAgIHR5cGU6IFwiY2hpbGRMaXN0XCIsXG4gICAgICAgICAgICB0YXJnZXQ6IGV2Py5jdXJyZW50VGFyZ2V0LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvL1xuICAgIGNvbnN0IGhhbmRsZU91dENvbWUgPSAoZXYpPT57XG4gICAgICAgIGhhbmRsZU11dGF0aW9uKHtcbiAgICAgICAgICAgIGFkZGVkTm9kZXM6IFtldj8ucmVsYXRlZFRhcmdldF0uZmlsdGVyKChlbCk9PiEhZWwpLFxuICAgICAgICAgICAgcmVtb3ZlZE5vZGVzOiBbZXY/LnRhcmdldF0uZmlsdGVyKChlbCk9PiEhZWwpLFxuICAgICAgICAgICAgdHlwZTogXCJjaGlsZExpc3RcIixcbiAgICAgICAgICAgIHRhcmdldDogZXY/LmN1cnJlbnRUYXJnZXQsXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vXG4gICAgY29uc3QgaGFuZGxlRm9jdXNDbGljayA9IChldik9PntcbiAgICAgICAgaGFuZGxlTXV0YXRpb24oe1xuICAgICAgICAgICAgYWRkZWROb2RlczogW2V2Py50YXJnZXRdLmZpbHRlcigoZWwpPT4hIWVsKSxcbiAgICAgICAgICAgIHJlbW92ZWROb2RlczogW2V2Py5yZWxhdGVkVGFyZ2V0IHx8IGRvY3VtZW50Py5hY3RpdmVFbGVtZW50XS5maWx0ZXIoKGVsKT0+ISFlbCksXG4gICAgICAgICAgICB0eXBlOiBcImNoaWxkTGlzdFwiLFxuICAgICAgICAgICAgdGFyZ2V0OiBldj8uY3VycmVudFRhcmdldCxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gY2FwdHVyZTogZmFsc2UgLSBmcm9tIHBhcmVudHMgdG8gY2hpbGRyZW4sIHRydWUgLSBmcm9tIGNoaWxkcmVuIHRvIHBhcmVudHNcbiAgICAvLyBwYXNzaXZlOiB0cnVlIC0gb3B0aW1hbCBmb3Igc2VsZWN0b3IgZXZlbnRzXG4gICAgY29uc3QgZmFjdG9ycyA9IHtcbiAgICAgICAgcGFzc2l2ZTogdHJ1ZSxcbiAgICAgICAgY2FwdHVyZTogZmFsc2UsXG4gICAgfTtcblxuICAgIC8vXG4gICAgaWYgKHNlbGVjdG9yPy5pbmNsdWRlcz8uKFwiOmhvdmVyXCIpICYmIHNlbGVjdG9yPy5pbmNsdWRlcz8uKFwiOmFjdGl2ZVwiKSkge1xuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVyb3ZlclwiLCBoYW5kbGVDb21lLCBmYWN0b3JzKTtcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcm91dFwiLCBoYW5kbGVPdXRDb21lLCBmYWN0b3JzKTtcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcmRvd25cIiwgaGFuZGxlQ29tZSwgZmFjdG9ycyk7XG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJ1cFwiLCBoYW5kbGVPdXRDb21lLCBmYWN0b3JzKTtcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcmNhbmNlbFwiLCBoYW5kbGVPdXRDb21lLCBmYWN0b3JzKTtcbiAgICAgICAgcmV0dXJuIHsgZGlzY29ubmVjdDogKCk9PntcbiAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJvdmVyXCIsIGhhbmRsZUNvbWUsIGZhY3RvcnMpO1xuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcm91dFwiLCBoYW5kbGVPdXRDb21lLCBmYWN0b3JzKTtcbiAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJkb3duXCIsIGhhbmRsZUNvbWUsIGZhY3RvcnMpO1xuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcnVwXCIsIGhhbmRsZU91dENvbWUsIGZhY3RvcnMpO1xuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcmNhbmNlbFwiLCBoYW5kbGVPdXRDb21lLCBmYWN0b3JzKTtcbiAgICAgICAgfSB9O1xuICAgIH1cblxuICAgIC8vXG4gICAgaWYgKHNlbGVjdG9yPy5pbmNsdWRlcz8uKFwiOmhvdmVyXCIpKSB7XG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJvdmVyXCIsIGhhbmRsZUNvbWUsIGZhY3RvcnMpO1xuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVyb3V0XCIsIGhhbmRsZU91dENvbWUsIGZhY3RvcnMpO1xuICAgICAgICByZXR1cm4geyBkaXNjb25uZWN0OiAoKT0+e1xuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcm92ZXJcIiwgaGFuZGxlQ29tZSwgZmFjdG9ycyk7XG4gICAgICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2ludGVyb3V0XCIsIGhhbmRsZU91dENvbWUsIGZhY3RvcnMpO1xuICAgICAgICB9IH07XG4gICAgfVxuXG4gICAgLy9cbiAgICBpZiAoc2VsZWN0b3I/LmluY2x1ZGVzPy4oXCI6YWN0aXZlXCIpKSB7XG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJkb3duXCIsIGhhbmRsZUNvbWUsIGZhY3RvcnMpO1xuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVydXBcIiwgaGFuZGxlT3V0Q29tZSwgZmFjdG9ycyk7XG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJjYW5jZWxcIiwgaGFuZGxlT3V0Q29tZSwgZmFjdG9ycyk7XG4gICAgICAgIHJldHVybiB7IGRpc2Nvbm5lY3Q6ICgpPT57XG4gICAgICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2ludGVyZG93blwiLCBoYW5kbGVDb21lLCBmYWN0b3JzKTtcbiAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJ1cFwiLCBoYW5kbGVPdXRDb21lLCBmYWN0b3JzKTtcbiAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJjYW5jZWxcIiwgaGFuZGxlT3V0Q29tZSwgZmFjdG9ycyk7XG4gICAgICAgIH0gfTtcbiAgICB9XG5cbiAgICAvL1xuICAgIGlmIChzZWxlY3Rvcj8uaW5jbHVkZXM/LihcIjpmb2N1c1wiKSAmJiBzZWxlY3Rvcj8uaW5jbHVkZXM/LihcIjpmb2N1cy13aXRoaW5cIikgJiYgc2VsZWN0b3I/LmluY2x1ZGVzPy4oXCI6Zm9jdXMtdmlzaWJsZVwiKSkge1xuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c2luXCIsIGhhbmRsZUNvbWUsIGZhY3RvcnMpO1xuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c291dFwiLCBoYW5kbGVPdXRDb21lLCBmYWN0b3JzKTtcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlRm9jdXNDbGljaywgZmFjdG9ycyk7XG4gICAgICAgIHJldHVybiB7IGRpc2Nvbm5lY3Q6ICgpPT57XG4gICAgICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJmb2N1c2luXCIsIGhhbmRsZUNvbWUsIGZhY3RvcnMpO1xuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiZm9jdXNvdXRcIiwgaGFuZGxlT3V0Q29tZSwgZmFjdG9ycyk7XG4gICAgICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVGb2N1c0NsaWNrLCBmYWN0b3JzKTtcbiAgICAgICAgfSB9O1xuICAgIH1cblxuICAgIC8vXG4gICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigobXV0YXRpb25MaXN0LCBvYnNlcnZlcikgPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IG11dGF0aW9uIG9mIG11dGF0aW9uTGlzdCkge1xuICAgICAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT0gXCJjaGlsZExpc3RcIikge1xuICAgICAgICAgICAgICAgIGhhbmRsZU11dGF0aW9uKG11dGF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy9cbiAgICBjb25zdCBvYlJlZiA9IG5ldyBXZWFrUmVmKG9ic2VydmVyKTtcbiAgICBpZiAoKGVsZW1lbnQ/LmVsZW1lbnQgPz8gZWxlbWVudCkgaW5zdGFuY2VvZiBOb2RlKSB7XG4gICAgICAgIG9ic2VydmVyLm9ic2VydmUoZWxlbWVudCA9IHVud3JhcEZyb21RdWVyeShlbGVtZW50KSwgeyBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWUgOiB0cnVlIH0pO1xuICAgIH1cbiAgICBjb25zdCBzZWxlY3RlZCA9IEFycmF5LmZyb20oZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSk7XG4gICAgaWYgKHNlbGVjdGVkLmxlbmd0aCA+IDApIHsgY2I/Lih7IGFkZGVkTm9kZXM6IHNlbGVjdGVkIH0sIG9ic2VydmVyKTsgfTtcbiAgICByZXR1cm4gb2JzZXJ2ZXI7XG59O1xuIl19