import { setStyleProperty } from "./Style";
import { camelToKebab, hasValue, isVal, isValueUnit, kebabToCamel, normalizePrimitive, $avoidTrigger } from "fest/core";
//
export const handleHidden = (element, _, visible) => {
    const $ref = visible;
    if (hasValue(visible)) {
        visible = visible.value;
    }
    ;
    const isVisible = (visible = normalizePrimitive(visible)) != null && visible !== false;
    //
    $avoidTrigger($ref, () => {
        if (element instanceof HTMLInputElement) {
            element.hidden = !isVisible;
        }
        else {
            if (isVisible) {
                element?.removeAttribute?.("data-hidden");
            }
            else {
                element?.setAttribute?.("data-hidden", "");
            }
        }
    });
    //
    return element;
};
//
export const handleProperty = (el, prop, val) => {
    if (!(prop = typeof prop == "string" ? kebabToCamel(prop) : prop) || !el || ["style", "dataset", "attributeStyleMap", "styleMap", "computedStyleMap"].indexOf(prop || "") != -1)
        return el;
    const $ref = val;
    //
    if (hasValue(val)) {
        val = val.value;
    }
    ;
    //
    if (el?.[prop] === val) {
        return el;
    }
    ;
    if (el?.[prop] !== val) {
        $avoidTrigger($ref, () => {
            if (val != null) {
                el[prop] = val;
            }
            else {
                delete el[prop];
            }
            ;
        });
    }
    return el;
};
//
export const handleDataset = (el, prop, val) => {
    const datasetRef = el?.dataset;
    if (!prop || !el || !datasetRef)
        return el;
    const $ref = val; // @ts-ignore
    if (hasValue(val))
        val = val?.value;
    prop = kebabToCamel(prop);
    if (datasetRef?.[prop] === (val = normalizePrimitive(val)))
        return el;
    if (val == null || val === false) {
        delete datasetRef[prop];
    }
    else {
        $avoidTrigger($ref, () => {
            if (typeof val != "object" && typeof val != "function") {
                datasetRef[prop] = String(val);
            }
            else {
                delete datasetRef[prop];
            }
        });
    }
    return el;
};
//
export const deleteStyleProperty = (el, name) => el.style.removeProperty(camelToKebab(name));
//
export const handleStyleChange = (el, prop, val) => {
    const styleRef = el?.style;
    if (!prop || typeof prop != "string" || !el || !styleRef)
        return el;
    //if (hasValue(val) && !isValueUnit(val)) val = val.value;
    //
    const $ref = val;
    $avoidTrigger($ref, () => {
        //if (val == null) { deleteStyleProperty(el, prop); } else
        if (isVal(val) || hasValue(val) || isValueUnit(val)) {
            setStyleProperty(el, prop, val);
        }
        else if (val == null) {
            deleteStyleProperty(el, prop);
        }
    });
    //
    return el;
};
//
export const handleAttribute = (el, prop, val) => {
    if (!prop || !el)
        return el;
    //
    const $ref = val;
    if (hasValue(val))
        val = val.value;
    prop = camelToKebab(prop);
    if (el?.getAttribute?.(prop) === (val = normalizePrimitive(val))) {
        return el;
    }
    //
    $avoidTrigger($ref, () => {
        if ((typeof val != "object" && typeof val != "function") && val != null && (typeof val == "boolean" ? val == true : true)) {
            el?.setAttribute?.(prop, String(val));
        }
        else {
            el?.removeAttribute?.(prop);
        }
    });
    //
    return el;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkhhbmRsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQzNDLE9BQU8sRUFBRSxZQUFZLEVBQWdCLFFBQVEsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxrQkFBa0IsRUFBRSxhQUFhLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFdEksRUFBRTtBQUNGLE1BQU0sQ0FBQyxNQUFNLFlBQVksR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLEVBQUU7SUFDaEQsTUFBTSxJQUFJLEdBQVEsT0FBTyxDQUFDO0lBQzFCLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQTtJQUFDLENBQUM7SUFBQSxDQUFDO0lBQ25ELE1BQU0sU0FBUyxHQUFHLENBQUMsT0FBTyxHQUFHLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLE9BQU8sS0FBSyxLQUFLLENBQUM7SUFFdkYsRUFBRTtJQUNGLGFBQWEsQ0FBQyxJQUFJLEVBQUUsR0FBRSxFQUFFO1FBQ3BCLElBQUksT0FBTyxZQUFZLGdCQUFnQixFQUFFLENBQUM7WUFBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsU0FBUyxDQUFDO1FBQUMsQ0FBQzthQUNyRSxDQUFDO1lBQUMsSUFBSSxTQUFTLEVBQUUsQ0FBQztnQkFBQyxPQUFPLEVBQUUsZUFBZSxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUM7WUFBQyxDQUFDO2lCQUFNLENBQUM7Z0JBQUMsT0FBTyxFQUFFLFlBQVksRUFBRSxDQUFDLGFBQWEsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUFDLENBQUM7UUFBQyxDQUFDO0lBQzlILENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRTtJQUNGLE9B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SUFBSSxHQUFRLEdBQUcsQ0FBQztJQUN0QixJQUFJLFFBQVEsQ0FBQyxHQUFHLENBQUM7UUFBRSxHQUFHLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQztJQUFDLElBQUksR0FBRyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDOUQsSUFBSSxFQUFFLEVBQUUsWUFBWSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsa0JBQWtCLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQy9ELE9BQU8sRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQUVELEVBQUU7SUFDRixhQUFhLENBQUMsSUFBSSxFQUFFLEdBQUUsRUFBRTtRQUNwQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksUUFBUSxJQUFJLE9BQU8sR0FBRyxJQUFJLFVBQVUsQ0FBQyxJQUFJLEdBQUcsSUFBSSxJQUFJLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDeEgsRUFBRSxFQUFFLFlBQVksRUFBRSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMxQyxDQUFDO2FBQU0sQ0FBQztZQUNKLEVBQUUsRUFBRSxlQUFlLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFO0lBQ0YsT0FBTyxFQUFFLENBQUM7QUFDZCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzZXRTdHlsZVByb3BlcnR5IH0gZnJvbSBcIi4vU3R5bGVcIjtcbmltcG9ydCB7IGNhbWVsVG9LZWJhYiwgRGF0YXNldFZhbHVlLCBoYXNWYWx1ZSwgaXNWYWwsIGlzVmFsdWVVbml0LCBrZWJhYlRvQ2FtZWwsIG5vcm1hbGl6ZVByaW1pdGl2ZSwgJGF2b2lkVHJpZ2dlciB9IGZyb20gXCJmZXN0L2NvcmVcIjtcblxuLy9cbmV4cG9ydCBjb25zdCBoYW5kbGVIaWRkZW4gPSAoZWxlbWVudCwgXywgdmlzaWJsZSkgPT4ge1xuICAgIGNvbnN0ICRyZWY6IGFueSA9IHZpc2libGU7XG4gICAgaWYgKGhhc1ZhbHVlKHZpc2libGUpKSB7IHZpc2libGUgPSB2aXNpYmxlLnZhbHVlIH07XG4gICAgY29uc3QgaXNWaXNpYmxlID0gKHZpc2libGUgPSBub3JtYWxpemVQcmltaXRpdmUodmlzaWJsZSkpICE9IG51bGwgJiYgdmlzaWJsZSAhPT0gZmFsc2U7XG5cbiAgICAvL1xuICAgICRhdm9pZFRyaWdnZXIoJHJlZiwgKCk9PntcbiAgICAgICAgaWYgKGVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7IGVsZW1lbnQuaGlkZGVuID0gIWlzVmlzaWJsZTsgfSBlbHNlXG4gICAgICAgICAgICB7IGlmIChpc1Zpc2libGUpIHsgZWxlbWVudD8ucmVtb3ZlQXR0cmlidXRlPy4oXCJkYXRhLWhpZGRlblwiKTsgfSBlbHNlIHsgZWxlbWVudD8uc2V0QXR0cmlidXRlPy4oXCJkYXRhLWhpZGRlblwiLCBcIlwiKTsgfSB9XG4gICAgfSk7XG5cbiAgICAvL1xuICAgIHJldHVybiBlbGVtZW50O1xufVxuXG4vL1xuZXhwb3J0IGNvbnN0IGhhbmRsZVByb3BlcnR5ID0gKGVsPzogSFRNTEVsZW1lbnR8bnVsbCwgcHJvcD86IHN0cmluZ3xudWxsLCB2YWw/OiBhbnkpPT57XG4gICAgaWYgKCEocHJvcCA9IHR5cGVvZiBwcm9wID09IFwic3RyaW5nXCIgPyBrZWJhYlRvQ2FtZWwocHJvcCkgOiBwcm9wKSB8fCAhZWwgfHwgW1wic3R5bGVcIiwgXCJkYXRhc2V0XCIsIFwiYXR0cmlidXRlU3R5bGVNYXBcIiwgXCJzdHlsZU1hcFwiLCBcImNvbXB1dGVkU3R5bGVNYXBcIl0uaW5kZXhPZihwcm9wIHx8IFwiXCIpICE9IC0xKSByZXR1cm4gZWw7XG4gICAgY29uc3QgJHJlZjogYW55ID0gdmFsO1xuXG4gICAgLy9cbiAgICBpZiAoaGFzVmFsdWUodmFsKSkgeyB2YWwgPSB2YWwudmFsdWU7IH07XG5cbiAgICAvL1xuICAgIGlmIChlbD8uW3Byb3BdID09PSB2YWwpIHsgcmV0dXJuIGVsOyB9O1xuICAgIGlmIChlbD8uW3Byb3BdICE9PSB2YWwpIHtcbiAgICAgICAgJGF2b2lkVHJpZ2dlcigkcmVmLCAoKT0+e1xuICAgICAgICAgICAgaWYgKHZhbCAhPSBudWxsKSB7IGVsW3Byb3BdID0gdmFsOyB9IGVsc2UgeyBkZWxldGUgZWxbcHJvcF07IH07XG4gICAgICAgIH0pXG4gICAgfVxuICAgIHJldHVybiBlbDtcbn1cblxuLy9cbmV4cG9ydCBjb25zdCBoYW5kbGVEYXRhc2V0ID0gKGVsPzogSFRNTEVsZW1lbnR8bnVsbCwgcHJvcD86IHN0cmluZywgdmFsPzogRGF0YXNldFZhbHVlKSA9PiB7XG4gICAgY29uc3QgZGF0YXNldFJlZiA9IGVsPy5kYXRhc2V0OyBpZiAoIXByb3AgfHwgIWVsIHx8ICFkYXRhc2V0UmVmKSByZXR1cm4gZWw7XG4gICAgY29uc3QgJHJlZjogYW55ID0gdmFsOyAgLy8gQHRzLWlnbm9yZVxuICAgIGlmIChoYXNWYWx1ZSh2YWwpKSB2YWwgPSB2YWw/LnZhbHVlOyBwcm9wID0ga2ViYWJUb0NhbWVsKHByb3ApO1xuICAgIGlmIChkYXRhc2V0UmVmPy5bcHJvcF0gPT09ICh2YWwgPSBub3JtYWxpemVQcmltaXRpdmUodmFsKSkpIHJldHVybiBlbDtcbiAgICBpZiAodmFsID09IG51bGwgfHwgdmFsID09PSBmYWxzZSkgeyBkZWxldGUgZGF0YXNldFJlZltwcm9wXTsgfSBlbHNlIHtcbiAgICAgICAgJGF2b2lkVHJpZ2dlcigkcmVmLCAoKT0+e1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWwgIT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgdmFsICE9IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIGRhdGFzZXRSZWZbcHJvcF0gPSBTdHJpbmcodmFsKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGRhdGFzZXRSZWZbcHJvcF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gZWw7XG59O1xuXG4vL1xuZXhwb3J0IGNvbnN0IGRlbGV0ZVN0eWxlUHJvcGVydHkgPSAoZWw6IEhUTUxFbGVtZW50LCBuYW1lOiBzdHJpbmcpID0+IGVsLnN0eWxlLnJlbW92ZVByb3BlcnR5KGNhbWVsVG9LZWJhYihuYW1lKSk7XG5cbi8vXG5leHBvcnQgY29uc3QgaGFuZGxlU3R5bGVDaGFuZ2UgPSAoZWw/OiBIVE1MRWxlbWVudCB8IG51bGwsIHByb3A/OiBzdHJpbmcsIHZhbD86IGFueSkgPT4ge1xuICAgIGNvbnN0IHN0eWxlUmVmID0gZWw/LnN0eWxlO1xuICAgIGlmICghcHJvcCB8fCB0eXBlb2YgcHJvcCAhPSBcInN0cmluZ1wiIHx8ICFlbCB8fCAhc3R5bGVSZWYpIHJldHVybiBlbDtcbiAgICAvL2lmIChoYXNWYWx1ZSh2YWwpICYmICFpc1ZhbHVlVW5pdCh2YWwpKSB2YWwgPSB2YWwudmFsdWU7XG5cbiAgICAvL1xuICAgIGNvbnN0ICRyZWY6IGFueSA9IHZhbDtcbiAgICAkYXZvaWRUcmlnZ2VyKCRyZWYsICgpPT57XG4gICAgICAgIC8vaWYgKHZhbCA9PSBudWxsKSB7IGRlbGV0ZVN0eWxlUHJvcGVydHkoZWwsIHByb3ApOyB9IGVsc2VcbiAgICAgICAgaWYgKGlzVmFsKHZhbCkgfHwgaGFzVmFsdWUodmFsKSB8fCBpc1ZhbHVlVW5pdCh2YWwpKVxuICAgICAgICAgICAgeyBzZXRTdHlsZVByb3BlcnR5KGVsLCBwcm9wLCB2YWwpOyB9IGVsc2UgaWYgKHZhbCA9PSBudWxsKVxuICAgICAgICAgICAgeyBkZWxldGVTdHlsZVByb3BlcnR5KGVsLCBwcm9wKTsgfVxuICAgIH0pO1xuXG4gICAgLy9cbiAgICByZXR1cm4gZWw7XG59O1xuXG4vL1xuZXhwb3J0IGNvbnN0IGhhbmRsZUF0dHJpYnV0ZSA9IChlbD86IEhUTUxFbGVtZW50IHwgbnVsbCwgcHJvcD86IHN0cmluZywgdmFsPzogYW55KSA9PiB7XG4gICAgaWYgKCFwcm9wIHx8ICFlbCkgcmV0dXJuIGVsO1xuXG4gICAgLy9cbiAgICBjb25zdCAkcmVmOiBhbnkgPSB2YWw7XG4gICAgaWYgKGhhc1ZhbHVlKHZhbCkpIHZhbCA9IHZhbC52YWx1ZTsgcHJvcCA9IGNhbWVsVG9LZWJhYihwcm9wKTtcbiAgICBpZiAoZWw/LmdldEF0dHJpYnV0ZT8uKHByb3ApID09PSAodmFsID0gbm9ybWFsaXplUHJpbWl0aXZlKHZhbCkpKSB7XG4gICAgICAgIHJldHVybiBlbDtcbiAgICB9XG5cbiAgICAvL1xuICAgICRhdm9pZFRyaWdnZXIoJHJlZiwgKCk9PntcbiAgICAgICAgaWYgKCh0eXBlb2YgdmFsICE9IFwib2JqZWN0XCIgJiYgdHlwZW9mIHZhbCAhPSBcImZ1bmN0aW9uXCIpICYmIHZhbCAhPSBudWxsICYmICh0eXBlb2YgdmFsID09IFwiYm9vbGVhblwiID8gdmFsID09IHRydWUgOiB0cnVlKSkge1xuICAgICAgICAgICAgZWw/LnNldEF0dHJpYnV0ZT8uKHByb3AsIFN0cmluZyh2YWwpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGVsPy5yZW1vdmVBdHRyaWJ1dGU/Lihwcm9wKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy9cbiAgICByZXR1cm4gZWw7XG59O1xuIl19